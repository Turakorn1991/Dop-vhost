<?php
//TODO: Bypass authen
//set_session('pers_authen',array('authen_log_id'=>223,'pid'=>'3101701933555','cid'=>'0221004350953232','random_string'=>'80db7f660e7ef6255597fc5794be0093')); //for Test
?>  
<script>
  //Declear Info Reader PID
  var user_id = '<?php echo get_session('user_id');?>';
  var org_id = '<?php echo get_session('org_id');?>';
  var pers_authen = JSON.parse('<?php echo json_encode(get_session('pers_authen'));?>');
  console.log(pers_authen);
  var reader_status = false;
  var authen_log_id = 0;
  //End Declear Info Reader PID
  var csrf_hash='<?php echo @$csrf['hash'];?>';
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>




            <div class="row">
                <div class="col-lg-12">
                    <div class="tabs-container">
                        <ul class="nav nav-tabs">
                            <li class="active">
                              <?php
                                $tmp = $this->admin_model->getOnce_Application(13);
                                $tmp1 = $this->admin_model->chkOnce_usrmPermiss(13,$user_id); //Check User Permission
                              ?>
                                <a <?php if(!isset($tmp1['perm_status'])) {?>
                                    readonly
                                  <?php }else if($process_action!='Add'){?> href="<?php echo site_url('welfare/inform1/Edit/'.@$adm_info['adm_id']);?>" <?php }?>  data-toggle="tab" <?php if($usrpm['app_id']==13){?>aria-expanded="true" <?php }else{?> aria-expanded="false"<?php }?>> (1) แจ้งความประสงค์</a>
                            </li>
                            <li>
                              <?php
                                $tmp = $this->admin_model->getOnce_Application(14);
                                $tmp1 = $this->admin_model->chkOnce_usrmPermiss(14,$user_id); //Check User Permission
                              ?>
                                <a <?php if(!isset($tmp1['perm_status'])) {?>
                                    readonly
                                    <?php //echo site_url('welfare/admission2/Edit/'.@$adm_info['adm_id']);?>
                                  <?php }else if($process_action!='Add'){?> href="#" <?php }?>  <?php if($usrpm['app_id']==14){?>aria-expanded="true" <?php }?>>(2) รับเข้า/จำหน่าย</a>
                            </li>
                            <li>
                              <?php
                                $tmp = $this->admin_model->getOnce_Application(15);
                                $tmp1 = $this->admin_model->chkOnce_usrmPermiss(15,$user_id); //Check User Permission
                              ?>
                                <a <?php if(!isset($tmp1['perm_status'])) {?>
                                    readonly
                                    <?php //echo site_url('welfare/estimate3/View/'.@$adm_info['adm_id']);?>
                                  <?php }else if($process_action!='Add'){?> href="#" <?php }?>  <?php if($usrpm['app_id']==5){?>aria-expanded="true" <?php }?>>(3) ประเมินสมรรถภาพ</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div id="tab-1" <?php if($usrpm['app_id']==13){?>class="tab-pane active" <?php }else{?> class="tab-pane"<?php }?>>
                                <div class="panel-body">

                                   <!--
                                    <div class="row">
                                        <div class="col-lg-12" style="padding-top: 15px; padding-bottom: 15px;">
                                            <h2 style="color: #4e5f4d"></h2>
                                            <div class="col-lg-12 text-right  border-bottom">
                                                  <?php
                                                  if($process_action=='Edit') {
                                                  ?>
                                                  <a data-toggle="modal" data-target="#myPrint" style="color: #000; padding-left: 20px; padding-right: 20px;" title="พิมพ์แบบฟอร์ม" class="btn btn-default">
                                                      <i class="fa fa-file-text" aria-hidden="true"></i>
                                                  </a>
                                                  <?php
                                                  }
                                                  ?>

                                                  &nbsp;
                                                  <?php
                                                    $tmp = $this->admin_model->getOnce_Application(13);
                                                    $tmp1 = $this->admin_model->chkOnce_usrmPermiss(13,$user_id); //Check User Permission
                                                  ?>
                                                  <a <?php if(!isset($tmp1['perm_status'])) {?>
                                                    readonly
                                                  <?php }else{?> onclick="return opnCnfrom()" <?php }?> style="color: #000; padding-left: 20px; padding-right: 20px;" title="บันทึกช้อมูล" class="btn btn-default">
                                                      <i class="fa fa-floppy-o" aria-hidden="true"></i>
                                                  </a>

                                                  &nbsp;
                                                  <?php
                                                    $tmp = $this->admin_model->getOnce_Application(13);
                                                    $tmp1 = $this->admin_model->chkOnce_usrmPermiss(13,$user_id); //Check User Permission
                                                  ?>
                                                  <a onclick="return opnBck()" <?php if(!isset($tmp1['perm_status'])) {?>
                                                    readonly
                                                  <?php }else{?> href="<?php echo site_url('welfare/welfare_list');?>" <?php }?> style="color: #000; padding-left: 20px; padding-right: 20px;" title="ย้อนกลับ" class="btn btn-default">
                                                      <i class="fa fa-undo" aria-hidden="true"></i>
                                                  </a>

                                                  <?php
                                                  if($process_action=='Edit') {
                                                  ?>
                                                  &nbsp;
                                                  <?php
                                                    $tmp = $this->admin_model->getOnce_Application(13);
                                                    $tmp1 = $this->admin_model->chkOnce_usrmPermiss(13,$user_id); //Check User Permission
                                                  ?>
                                                  <a data-id=<?php echo @$adm_info['adm_id'];?> onclick="opn(this)" <?php if(!isset($tmp1['perm_status'])) {?>
                                                    readonly
                                                  <?php }?> style="color: #000; padding-left: 20px; padding-right: 20px;" title="ลบข้อมูล" class="btn btn-default">
                                                      <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>
                                                  </a>
                                                  <?php
                                                  }
                                                  ?>

                                            </div>
                                        </div>
                                    </div>
                                    -->

                                    <div id="tmp_menu" hidden='hidden'>

                                        <!--
                                       <?php if($process_action=='Edit') { ?>
                                        <a  title="พิมพ์แบบฟอร์ม" data-toggle="modal" data-target="#myPrint" class="navbar-minimalize minimalize-styl-2 btn btn-primary" style="margin-top: 11px; margin-left: 0px; background-color: #2f4250; border: 0;font-size: 17px; padding: 5px 20px 3px 20px;" href="" data-toggle="modal" data-target="#mySearch">
                                        <i class="fa fa-file-text" aria-hidden="true"></i> </a>
                                       <?php }?>


                                        <?php
                                          $tmp = $this->admin_model->getOnce_Application(13);
                                          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(13,$user_id); //Check User Permission
                                        ?>
                                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary" style="margin-top: 11px; margin-left: 0px; background-color: #2f4250; border: 0;font-size: 17px; padding: 5px 20px 3px 20px;"
                                        <?php if(!isset($tmp1['perm_status'])) {?>
                                                readonly
                                              <?php }else{?> onclick="return opnCnfrom()"
                                        <?php }?> title="บันทึก<?php //if(isset($tmp['app_name'])){echo $tmp['app_name'];}?>">
                                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                                        </a>
                                        -->

                                        <?php
                                          $tmp = $this->admin_model->getOnce_Application(6);
                                          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(6,$user_id); //Check User Permission
                                        ?>

                                        <!--
                                        <?php
                                        if($process_action=='Edit') {

                                        ?>
                                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary" style="margin-top: 11px; margin-left: 0px; background-color: #2f4250; border: 0;font-size: 17px; padding: 5px 20px 3px 20px;"  data-id=<?php echo @$adm_info['adm_id'];?> onclick="opn(this)" title="ลบ">
                                        <i class="fa fa-trash" aria-hidden="true"></i> </a>
                                        <?php } ?>




                                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary" style="margin-top: 11px; margin-left: 0px; background-color: #2f4250; border: 0;font-size: 17px; padding: 5px 20px 3px 20px;" href="<?php echo site_url('control/main_module');?>"><i class="fa fa-caret-left" aria-hidden="true"></i> </a>
                                        -->
                                    </div>
                                    <script>
                                      setTimeout(function(){
                                        $("#menu_topright").html($("#tmp_menu").html());
                                      },300);
                                    </script>
                                    
                            <div class="family_members_template" style="display: none;">
                              <div class="panel-group family_members_items" style="margin-top: -10px;">
                                <div class="panel panel-default" style="border: 0">
                                  <div class="panel-heading clear-fix" style="background-color: initial;">
                                  </div>
                                  <div class="panel-body" style="background-color:#FBFBFB;border: 1px #eee solid; padding: 15px;">
                                    <div class="row text-right">
                                      <button type="button" class="btn btn-default delfamily_members" onclick="btDel_family_members(this)" style="margin-right: 16px;"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                    </div>
                                    <div class="form-group row">
                                      <div class="col-xs-12 col-sm-3 ">
                                        <label class="col-2 col-form-label" style="font-weight: bold; color: red;" >เลขบัตรประจำตัวประชาชน</label>
                                            <input id="pid_myID" style="border-color:red;" title="เลขบัตรประจำตัวประชาชน" placeholder="เลขบัตรประจำตัวประชาชน (13 หลัก)" class="form-control input_idcard" type="text" name="pers_family[fml_pid][myID]"/>
                                      </div>
                                      <div class="col-xs-12 col-sm-3 dropdown">
                                          <label for="example-text-input" class="col-2 col-form-label">คำนำหน้านาม</label>
                                          <div class="col-10">
                                            <select title="คำนำหน้านาม" placeholder="เลือกคำนำหน้านาม" class="form-control elder_addr_pre" name="pers_family[pren_code][<?php echo $key;?>]">
                                              <option value="">เลือกคำนำหน้านาม</option>
                                              <?php
                                              $tmps = $this->common_model->custom_query("select * from std_prename");
                                              foreach ($tmps as $key1 => $value) {
                                              ?>
                                              <option <?php if(@$row['pren_code']==$value['pren_code']){?> selected<?php }?> value="<?php echo $value['pren_code'];?>"><?php echo $value['prename_th'];?></option>
                                              <?php
                                              }
                                              ?>
                                            </select>
                                          </div>
                                        </div>
                                      <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">ชื่อตัว</label>
                                        <input id="" title="ชื่อตัว" placeholder="ระบุชื่อตัว" class="form-control" type="text" name="pers_family[pers_firstname_th][myID]" />
                                      </div>
                                      <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">ชื่อสกุล</label>
                                        <input id="" title="ชื่อสกุล" placeholder="ระบุชื่อสกุล" class="form-control" type="text" name="pers_family[pers_lastname_th][myID]" />
                                      </div>
                                    </div>
                                    <!--//////////////////////////////////////////////////-->
                                    <div class="form-group row">
                                      <div class="col-xs-12 col-sm-6">
                                      <label class="col-2 col-form-label">สถานะการพักอาศัย</label>
                                      <select title="สถานะการพักอาศัย" placeholder="เลือกสถานะการพักอาศัย" class="form-control" name="pers_family[fml_pre_addr_status][myID]">
                                                    <option value="">เลือกสถานะการพักอาศัย</option>
                                                    <option value="บ้านตนเอง">บ้านตนเอง</option>
                                                    <option value="อาศัยผู้อื่นอยู่">อาศัยผู้อื่นอยู่</option>
                                                    <option value="บ้านเช่า">บ้านเช่า</option>
                                                    <option value="อยู่กับผู้จ้าง">อยู่กับผู้จ้าง</option>
                                                    <option value="ไม่มีที่อยู่อาศัยเป็นหลักแหล่ง">ไม่มีที่อยู่อาศัยเป็นหลักแหล่ง</option>
                                      </select>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">บ้านเลขที่</label>
                                      <input title="บ้านเลขที่" onkeyup="nonthnumber(this)" placeholder="ตัวอย่าง xxx/xxx" class="form-control" type="text" name="pers_family[fml_addr_home_no][myID]" />
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">หมู่ที่</label>
                                      <input title="หมู่ที่" class="form-control"  onkeyup="housenumber(this)" type="text" name="pers_family[fml_addr_moo][myID]" />
                                    </div>
                                    
                                  </div>
                                 <!--//////////////////////////////////////////////////-->
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">ตรอก</label>
                                      <input title="ตรอก" id="" class="form-control" type="text" onkeyup="nonthnumandeng(this)" name="pers_family[fml_addr_alley][myID]"  />
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">ซอย</label>
                                      <input title="ซอย"  class="form-control" type="text" onkeyup="addressvalidate(this)" name="pers_family[fml_addr_lane][myID]" />
                                    </div>
                                    <div class="col-xs-12 col-sm-6">
                                      <label class="col-2 col-form-label">ถนน</label>
                                      <input title="ถนน" class="form-control" onkeyup="nonthnumandeng(this)" type="text" name="pers_family[fml_addr_road][myID]" />
                                    </div>
                                    
                                  </div>

                                   <!--//////////////////////////////////////////////////-->
                                  <div class="form-group row pre_addr_dev">
                                    <div class="col-xs-12 col-sm-3 dropdown">
                                      <label for="example-text-input" class="col-2 col-form-label">จังหวัด</label>
                                      <div class="col-10">
                                      <select title="จังหวัด" placeholder="เลือกจังหวัด" class="form-control" id="fml_province" name="pers_family[fml_addr_province][myID]" onchange="optionGen2(this,'fml_amphur',<?php echo @$addr_info['district_code']; ?>);">
                                          <option value="">เลือกจังหวัด</option>
                                            <?php $temp = $this->personal_model->getAll_Province();
                                                foreach ($temp as $key => $row) { ?>
                                                
                                                <option value="<?php echo $row['area_name_th']; ?>" ><?php echo $row['area_name_th']; ?></option>
                                                <!-- <option <?php //if($row['area_code']==$row['area_code']){?> <?php //}?> value="<?php //echo $row['area_code'];?>"><?php //echo $row['area_name_th'];?></option> -->
                                            <?php  } ?>
                                      </select>
                                      </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-3 dropdown">
                                    <label for="example-text-input" class="col-2 col-form-label">อำเภอ</label>
                                    <div class="col-10">
                                    <select title="อำเภอ" placeholder="เลือกอำเภอ" class="form-control" id="fml_amphur" name="pers_family[fml_addr_district][myID]" onchange="optionGen2(this,'fml_tambon',<?php echo @$addr_info['sub_district_code']; ?>);" >
                                      <option value="">เลือกอำเภอ</option>
                                        <?php $temp = $this->personal_model->getAll_Amphur();
                                            foreach ($temp as $key => $row) { ?>
                                             <option value="<?php echo $row['area_name_th']; ?>"><?php echo $row['area_name_th']; ?></option>
                                            <?php  } ?>
                                      </select>
                                    </div>      
                                    </div>
                                    <div class="col-xs-12 col-sm-3 dropdown">
                                    <label for="example-text-input" class="col-2 col-form-label">ตำบล</label>
                                    <div class="col-10">
                                    <select title="ตำบล" placeholder="เลือกตำบล" class="form-control" id="fml_tambon" name="pers_family[fml_addr_sub_district][myID]" >
                                      <option value="">เลือกตำบล</option>
                                        <?php $temp = $this->personal_model->getAll_Tambon();
                                            foreach ($temp as $key => $row) { ?>
                                            <option value="<?php echo $row['area_name_th']; ?>"><?php echo $row['area_name_th']; ?></option>
                                            <?php  } ?>
                                      </select>
                                    </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">รหัสไปรษณีย์</label>
                                      <input title="รหัสไปรษณีย์" placeholder="ระบุรหัสไปรษณีย์ 5 หลัก" class="form-control" maxlength="5" onkeyup="numbervalid(this)" type="text" name="pers_family[fml_addr_zipcode][myID]"/>
                                    </div>
                                  </div>

                               <!--//////////////////////////////////////////////////-->

                                        <div class="form-group row">
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">อายุ (ปี)</label>
                                            <input title="อายุ" id="pers_age_myID" placeholder="ระบุอายุ (ปี)" class="form-control" onkeyup="numbervalid(this)" type="text" value="" name="pers_family[fml_age][myID]"/>
                                          </div>
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">เกี่ยวของเป็น</label>
                                            <input title="ความสัมพันธ์กับผู้สูงอายุ" placeholder="ระบุความสัมพันธ์กับผู้สูงอายุ" class="form-control" onkeyup="thvalidate(this)" type="text" name="pers_family[fml_relation][myID]" />
                                          </div>
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">อาชีพ</label>
                                            <input title="อาชีพ" placeholder="ระบุอาชีพ" class="form-control" type="text" id="occupation_myID" onkeyup="thvalidate(this)" name="pers_family[occupation][myID]" />
                                          </div>
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">รายได้เฉลี่ย (บาท/เดือน)</label>
                                            <input title="รายได้เฉลี่ย" placeholder="ระบุรายได้เฉลี่ย (บาท/เดือน)" class="form-control" onkeyup="numberndot(this)" type="text" id="mth_avg_income_myID" name="pers_family[mth_avg_income][myID]"/>
                                          </div>
                                        </div>

                                         <div class="form-group row">
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">เบอร์โทรศัพท์ (บ้าน)</label>
                                            <input title="อายุ" id="pers_age_myID" placeholder="ตัวอย่าง 02XXXXXXX ต่อ XXX" class="form-control" onkeyup="thnodash(this)" type="text"  name="pers_family[fml_tel_no_home][myID]"/>
                                          </div>
                                          <div class="col-xs-12 col-sm-3">
                                            <label class="col-2 col-form-label">เบอร์โทรศัพท์ (มือถือ)</label>
                                            <input title="อายุ" id="pers_age_myID" placeholder="ตัวอย่าง 08XXXXXXXX" maxlength="10" class="form-control" onkeyup="numbervalid(this)" type="text"  name="pers_family[fml_tel_no][myID]"/>
                                          </div>
                                            
                                        </div>

                                        <div class="form-group row">
                                          <div class="col-xs-12 col-sm-6">
                                            <label class="col-2 col-form-label">ปัญหาสุขภาพ</label>&nbsp;&nbsp;
                                            <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][myID]" value="ปกติ"><i></i>  ปกติ</label></div>&nbsp;&nbsp;&nbsp;
                                            <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][myID]" value="ผู้ป่วยเรื้อรัง"><i></i>  ผู้ป่วยเรื้อรัง</label></div>&nbsp;&nbsp;&nbsp;
                                            <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][myID]" value="ผู้พิการ"><i></i>  ผู้พิการ</label></div>
                                          </div><!--end colsm6-->
                                          <div class="col-xs-12 col-sm-6">
                                            <label class="col-2 col-form-label">ช่วยเหลือตนเอง</label>&nbsp;&nbsp;
                                            <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy_self_help][myID]" value="ได้"><i></i> ได้</label></div>
                                            <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy_self_help][myID]" value="ไม่ได้"><i></i> ไม่ได้</label></div>
                                          </div><!--end colsm6-->
                                        </div>
                                      </div><!--end form group row-->
                                    </div>

                                    <!-- <script>
                                      icheck_loop();
                                    </script> -->
                                  </div>

                                </div>


                              
                              

                                    <div class="form-group row">

                                                <div class="col-lg-12" id="integration0" hidden='hidden' style="padding:0">
                                                <div class="ibox float-e-margins">
                                                  <div class="ibox-title">
                                                  <div class="form-group row" style="font-size: 15px;">
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label for="datetimepicker1" class="col-2 col-form-label">เจ้าหน้าที่ : </label>
                                                      <span color='#eee'>
                                                      <?php
                                                      echo get_session('user_firstname').' '.get_session('user_lastname');
                                                      ?>
                                                      </span>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label for="datetimepicker1" class="col-2 col-form-label">หน่วยงาน : </label>
                                                      <span color='#eee'>
                                                      <?php
                                                      echo get_session('org_title');
                                                      ?>
                                                      </span>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label for="datetimepicker1" class="col-2 col-form-label">วันเวลา : </label>
                                                      <span color='#eee'>
                                                      <?php
                                                      $datetime = date("Y-m-d H:i:s");
                                                      $arr = explode(' ',$datetime);
                                                      echo dateChange($arr[0],5).' '.substr($arr[1], 0,5).'น.';
                                                      ?>
                                                      </span>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3 text-center" class="ibox-tools">
                                                      ประวัติการดูแลผู้สูงอายุ 
                                                      <span id="row0_history"> - รายการ
                                                      </span>

                                                        <a class="collapse-link">
                                                            <i class="fa fa-chevron-up" id="integration0_toggle"></i>
                                                        </a>
                                                        <a class="close-link">
                                                            <i class="fa fa-times"></i>
                                                        </a>
                                                    </div>
                                                  </div>

                      </div>
                        <div class="ibox-content" style="padding-bottom: 0px">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th style="width:4% !important; text-align:center;background-color: #459597; color: #fff">#</th>
                                        <th style="text-align:center;background-color: #459597; color: #fff">ผู้สูงอายุ</th>
                                        <th style="text-align:center;background-color: #459597; color: #fff">หน่วยงาน</th>
                                        <th style="text-align:center;background-color: #459597; color: #fff">วันที่รับเข้า</th>
                                        <th style="text-align:center;background-color: #459597; color: #fff">วันที่จำหน่าย</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    
                                    <tr>
                                        <td colspan="5">
                                            ไม่พบข้อมูล..
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>

                                    <?php
                                    $adm_id = '';

                                    if($process_action=='Add')$process_action = 'Added';
                                    if($process_action=='Edit'){$process_action = 'Edited'; @$adm_id = '/'.@$adm_info['adm_id'];}

                                    echo form_open_multipart('welfare/inform1/'.$process_action.$adm_id,array('id'=>'form1'));
                                    ?>

                                    <input type="hidden" name="<?php echo $csrf['name'];?>" value="<?php echo $csrf['hash'];?>" /> <!-- Set hidden csrf field -->

                                    <input type="submit" value="submit" name="bt_submit" hidden="hidden">


                               <?php echo validation_errors('<div class="error" style="font-size: 18px; padding-left: 20px">', '</div>'); ?>

                                    <div class="panel-group" style="margin-bottom: 0px;">
                                          <div class="panel panel-default" style="border: 0">
                                              <div class="panel-heading"><h4>ข้อมูลผู้ยืนคำขอ (ผู้แจ้งเรื่อง)</h4></div>
                                              <div class="panel-body" style="border:0; padding: 20px; ">
                                                  <div class="form-group row">
                                                    <div class="col-xs-12 col-sm-3" >                
                                                      <?php if($adm_info['adm_req_photo_file']!='') {?>
                                                                
                                                                <img src="<?php echo base_url().$adm_info['adm_req_photo_file'];?>" alt="..." class="image" >                              
                                                                <input type="file" name="img2"  class="img_0" accept="image/*"  style="display: none;" onchange="imgchange(this,'');">
                                                                <button id="btnAddimg" type="button" class="btn btn-default" style="width: 138px;" onclick="brwImg(this,'');">เปลี่ยนรูปภาพ</button>
                                                      <?php }else{ ?>
                                                                <img src="<?php echo path('noProfilePic.jpg','member');?>" class="image" >                                                               
                                                                <input type="file" name="img2"  class="img_0" accept="image/*"  style="display: none;" onchange="imgchange(this,'');">
                                                                <button id="btnAddimg" type="button" class="btn btn-default" style="width: 138px;" onclick="brwImg(this,'');">เพิ่มรูปภาพ</button>
                                                                    
                                                      <?php } ?>        
                                                  </div>

                                                    <div class="col-xs-12 col-sm-3 " style="padding: 7px 15px;"><span style="font-weight: bold; color:red;">เลขประจำตัวประชาชน</span> </div>
                                                    <div class="col-xs-12 col-sm-4" style="padding: 3px 15px;">

                                                      <div class="input-group" style="width: 295px;">
                                                         <input  title="เลขประจำตัวประชาชน" placeholder="เลขประจำตัวประชาชน (13 หลัก)" class="form-control input_idcard" type="text" value="<?php echo @$adm_info['req_pid'];?>" name="adm_info[req_pid]" id="req_pid" autofocus required/>
                                                         <div class="input-group-btn" style="padding-bottom: 5px;">
                                                              <button title="ตรวจสอบ" class="btn btn-default" type="button" onClick="bt_req_pid()" style="background-color:#F2DEDE; order-radius: 0px; left: 1px; border-color: #ed5565; color: #ed5565;padding:5px 12px;"><i class="fa fa-search" aria-hidden="true"></i></button>
                                                         </div>
                                                     </div>

                                                      <input type="hidden" id="req_pers_id" name="adm_info[req_pers_id]" value="<?php echo @$adm_info['req_pers_id'];?>">
                                                      <input type="hidden" id="diff_pid"  name="info_pid[pid]" value="<?php echo $adm_info['req_pid'];?>">
                                                      <input type="hidden" name="currtoken" id="currtoken" value="<?php echo !empty($token_id) ? $token_id:''; ?>"/>
                                 
                                                    </div>

                                                    <div class="col-xs-12 col-sm-2 has-error" style="padding: 3px 15px;">                                                      
                                                      <button type="button" class="btn btn-default " onClick="cardInfo()" title="ดึงข้อมูลจากบัตร" style="background-color:#F2DEDE; order-radius: 0px; left: 1px; border-color: #ed5565; color: #ed5565;padding:5px 12px;">ดึงข้อมูลจากบัตร</button> 
                                                    </div> 

												                          	<div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">ชื่อตัว/ชื่อสกุล</span></div>
                                                    <div class="col-xs-12 col-sm-6" style="padding: 7px 15px;" id="req_name"><?php echo $adm_info['req_name'];?> </div>

                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">วันเดือนปีเกิด</span></div>
                                                    <div class="col-xs-12 col-sm-6" style="padding: 7px 15px;" id="req_date_of_birth_text"><?php echo @$adm_info['req_date_of_birth'];?> </div>
												                          	<div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">เพศ</span> <span id="req_gender_name"><?php echo @$adm_info['req_gender_name'];?> </span> </div>
                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">สัญชาติ</span> <span id="req_nation_name_th"><?php echo @$adm_info['req_nation_name_th'];?> </span> </div>
												                          	<div class="col-xs-12 col-sm-6" style="padding: 7px 15px;"><span style="font-weight: bold;">ที่อยู่ตามทะเบียนบ้าน</span>
                                                    <span id="req_reg_addr"><?php echo @$adm_info['req_reg_add_info']; ?></span></div>

<input type="hidden" id="pers_firstname_th" name="impv_info[pers_firstname_th]" value="<?php echo $req_pers_info['pers_firstname_th'];?>">
<input type="hidden" id="pers_lastname_th" name="impv_info[pers_lastname_th]" value="<?php echo $req_pers_info['pers_lastname_th'];?>">
<input type="hidden" id="date_of_birth" name="impv_info[date_of_birth]" value="<?php echo $req_pers_info['date_of_birth'];?>">
<input type="hidden" id="req_reg_addr_id" name="impv_info[req_reg_addr_id]" value="<?php //echo $diff_info['pers_firstname_th'];?>">

<input type="hidden" id="gender_code" name="impv_info[gender_code]" value="<?php echo $req_pers_info['gender_code'];?>">

<input type="hidden"  name="impv_addr[addr_home_no]" value="<?php echo $addr_pers_info['addr_home_no'];?>">
<input type="hidden"  name="impv_addr[addr_moo]" value="<?php echo $addr_pers_info['addr_moo'];?>">
<input type="hidden"  name="impv_addr[addr_alley]" value="<?php echo $addr_pers_info['addr_alley'];?>">
<input type="hidden"  name="impv_addr[addr_lane]" value="<?php echo $addr_pers_info['addr_lane'];?>">
<input type="hidden"  name="impv_addr[addr_road]" value="<?php echo $addr_pers_info['addr_road'];?>">
<input type="hidden"  name="impv_addr[addr_province]" value="<?php echo $addr_pers_info['addr_province'];?>">
<input type="hidden"  name="impv_addr[addr_district]" value="<?php echo $addr_pers_info['addr_district'];?>">
<input type="hidden"  name="impv_addr[addr_sub_district]" value="<?php echo $addr_pers_info['addr_sub_district'];?>"> 

<input type="hidden" id="addr_province" name="pers_addr[addr_province]" value="<?php //echo $impv_home_info['addrProvince'];?>">
<input type="hidden" id="addr_district" name="pers_addr[addr_district]" value="<?php //echo $impv_home_info['addrAmphur'];?>">
<input type="hidden" id="addr_sub_district" name="pers_addr[addr_sub_district]" value="<?php //echo $impv_home_info['addrProvince'];?>"> 
                                                  
   
                                                        <script>
                                                        // var req_pers = null;
                                                        // var inputpid = "#req_pid";
                                                        // var bt_spid = "#bt_req_pid";
                                                        // var setData = "reqData"; //Declear Name
                                                        // var reqData = function(value) { //Set Structure Display Data
                                                        //   req_pers = value;
                                                        //   $("#req_name").html(value.name);
                                                        //   $("#req_date_of_birth").html(value.date_of_birth);
                                                        //   $("#req_gender_name").html(value.gender_name);
                                                        //   $("#req_nation_name_th").html(value.nation_name_th);
                                                        //   $("#req_relg_title").html(value.relg_title);
                                                        //   $("#req_pers_id").val(value.pers_id);
                                                        //   $("#req_reg_addr").text(value.reg_add_info);
                                                        // }
                                                        // $(bt_spid).click(function(){//On Click for Search
                                                        //   if($(inputpid).val()!='') {//pid not null

                                                        //    $(bt_spid).attr('disabled',true);

                                                        //     if(pers_authen!=null) { //Check Personal Authen
                                                        //       getPersInfo(inputpid,bt_spid,setData); //Get Data
                                                        //     }else if(!reader_status) { //Run Reader Personal
                                                        //       run_readerPers();
                                                        //       $(bt_spid).attr('disabled',false);
                                                        //       toastr.warning("ท่านยังไม่ได้ Authen เข้าใช้งานในฐานะเจ้าหน้าที่ ระบบกำลังเชื่อมโยงข้อมูลกับฐานข้อมูลหลัก","Authentications");
                                                        //     }

                                                        //   }else { //pid is null
                                                        //     $(inputpid).select();
                                                        //   }
                                                        // });

                                                      </script>

                                                     </div>

                                                  <div class="form-group row">
                                                    <div class="col-xs-12 col-sm-3 has-error">
                                                        <label for="datetimepicker1" class="col-2 col-form-label" style="color:red;">วันที่แจ้งเรื่อง </label>
                                              <div id="datetimepicker1" class="col-10 input-group date" data-date-format="dd-mm-yyyy">
                                                  <input title="วันที่แจ้งเรื่อง" placeholder="เลือกวันที่" class="form-control" type="text" name="adm_info[date_of_req]" required/>
                                                  <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                              </div>
                                                <script type="text/javascript">
                                                <?php
                                                $tmp = explode('-',@$adm_info['date_of_req']);
                                                ?>
                                                $(function () {
                                                $("#datetimepicker1").datepicker({
                                                  autoclose: true,
                                                  todayHighlight: true,
                                                  format: 'dd/mm/yyyy',
                                                   todayBtn: true,
                                                   language: 'th',
                                                   thaiyear: true
                                                })<?php if(count($tmp)==3){?>.datepicker('update', new Date(Date.UTC(<?php echo $tmp[2];?>,<?php echo $tmp[1];?>-1,<?php echo $tmp[0];?>)));<?php }?>
                                                });

                                                
                                                </script>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">ตำแหน่ง</label>
                                              <input title="ตำแหน่ง" placeholder="ระบุตำแหน่ง" class="form-control" type="text" onkeyup="numberandth(this)" name="adm_info[req_position]" value="<?php echo @$adm_info['req_position'];?>"/>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">หน่วยงาน</label>
                                              <input title="หน่วยงานต้นสังกัด" placeholder="ระบุหน่วยงานต้นสังกัด (ชื่อเต็มเท่านั้น)" class="form-control" onkeyup="numberandth(this)" type="text" name="adm_info[req_org]" value="<?php echo @$adm_info['req_org'];?>"/>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">เกี่ยวข้องเป็น</label>
                                              <input title="ความสัมพันธ์กับผู้สูงอายุ" placeholder="ระบุความสัมพันธ์กับผู้สูงอายุ" onkeyup="thvalidate(this)"  class="form-control" type="text" name="adm_info[req_relation]" value="<?php echo @$adm_info['req_relation'];?>"/>
                                                    </div>
                                          </div>
                                          <div class="form-group row">
                                         
                                                    <div class="col-xs-12 col-sm-3">
                                                      <label class="col-2 col-form-label">เบอร์โทรศัพท์ (ที่ติดต่อได้)</label>
                                                      <input title="เบอร์โทรศัพท์ (ที่ติดต่อได้)" placeholder="ตัวอย่าง 08XXXXXXXX"  class="form-control" onkeyup="thnodash(this)" type="type" name="adm_info[req_tel_no]" value="<?php echo @$adm_info['req_tel_no'];?>"/>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">ที่อยู่อีเมล</label>
                                                        <input title="ที่อยู่อีเมล" placeholder="ตัวอย่าง me@mail.com" class="form-control" type="email" onkeyup="nonthai(this)" name="adm_info[req_email_addr]" value="<?php echo @$adm_info['req_email_addr'];?>"/>
                                                    </div><!--end email -->

                                                     <div class="col-xs-12 col-sm-3 dropdown has-error">
                                                        <label for="example-text-input" class="col-2 col-form-label" style="color:red;">ช่องทางการแจ้งเรื่อง </label>
                                                        <div class="col-10">
                                                        <select id="chn_code" title="เลือกช่องทางการแจ้งเรื่อง" name="adm_info[chn_code]" placeholder="เลือกช่องทางการแจ้งเรื่อง" class="form-control" required>
                                                        <option value="">เลือกช่องทางการแจ้งเรื่อง</option>
                                                        <?php
                                                        $tmps = $this->difficult_model->getAll_reqChanel();
                                                        foreach ($tmps as $key => $value) {
                                                        ?>
                                                            <option <?php if($adm_info['chn_code']==$value['chn_code']) {?> selected <?php }?> value="<?php echo $value['chn_code'];?>"><?php echo $value['chn_name'];?></option>
                                                        <?php
                                                        }
                                                        ?>
                                                        </select>
                                                      </div><!--end col-10-->
                                                    </div><!--end col12-->
                                                    <?php
                                                      $usrm = $this->welfare_model->getUsrm(get_session('user_id'));
                                                      $first_org = $this->welfare_model->get_AdmInfo($adm_info['adm_id']);
                                                    
                                                    ?>
                                                    <input type="hidden" name="position" id="position" value="<?php echo $usrm['user_position']?>">
                                                    <input type="hidden" name="org" id="org" value="<?php echo $first_org['insert_org_id']?>">
                                                    <script type="text/javascript">
                             
                                                    $(document).ready(function(){
                                                            // console.log('org'+$("#org").val());
                                                                if($("#chn_code").val() =='007' && $("#position").val()=='2' &&  $("#org").val()=='174' ){
                                                                  $("#insert_org_id").toggle();
                                                                }
                                                                $("#Province").next().css("cssText", "border: 1px solid red; width:100%;");
                                                                $("#Amphur").next().css("cssText", "border: 1px solid red; width:100%;");
                                                                $("#Tambon").next().css("cssText", "border: 1px solid red; width:100%;");
                                                                $("#guide-book").click(function(){
                                                                  window.open('/assets/modules/welfare/guide/Adm_Manual.pdf', '_blank');
                                                                });
                                                              });  
                                                                        

                                                    </script>
                                                    <div id="insert_org_id" hidden='hidden' class="col-xs-12 col-sm-3 dropdown">
                                                      <label for="example-text-input" class="col-2 col-form-label" style="color:red;">ย้ายไปที่</label>
                                                      <div class="col-10 has-error">
                                                          <select id="insert_org_id" title="เลือกหน่วยงาน" name="adm_info[insert_org_id]" placeholder="เลือกหน่วยงาน" class="form-control" >
                                                          <option value="">เลือกหน่วยงาน</option>
                                                          <?php $tmp_cr = $this->common_model->custom_query("select * from usrm_org");
                                                              foreach ($tmp_cr as $row) { ?>
                                                              <option <?php if($adm_info['insert_org_id']==$value['org_id']) {?> selected <?php }?> value="<?php echo $row['org_id'];?>" ><?php echo $row['org_title']; ?></option>
                                                          <?php } ?>
                                                          </select>
                                                      </div>
                                                    </div><!--end ย้ายเรื่อง -->

                                            </div><!--row-->


                                              </div>

                                             <div class="panel-heading">
                                                <h4>ข้อมูลผู้สูงอายุ (ผู้ขอรับการสงเคราะห์) (
                                                <div class="checkbox-inline i-checks"><label><input type="checkbox" name="elder_pers_chk" id="elder_pers_chk"  
                                                <?php if(
                                                  $req_pers_info['pers_firstname_th']== $adm_info['pers_firstname_th']
                                                  && $req_pers_info['pers_lastname_th']== $adm_info['pers_lastname_th']
                                                  && $req_pers_info['date_of_birth']== $adm_info['date_of_birth_num']
                                                  && $addr_pers_info['addr_home_no']== $addr_diff_info['addr_home_no']
                                                  && $req_pers_info['pers_firstname_th'] != ""
                                                  ){ echo "checked"; }?> > บุคคลเดียวกับผู้ยื่นคำขอ</label></div> )

                                                <input type="hidden" id="pers_firstname_th" name="impv_info2[pers_firstname_th]" value="<?php echo $adm_info['pers_firstname_th'];?>">
                                                <input type="hidden" id="pers_lastname_th" name="impv_info2[pers_lastname_th]" value="<?php echo $adm_info['pers_lastname_th'];?>">
                                                <input type="hidden" id="date_of_birth" name="impv_info2[date_of_birth]" value="<?php echo $adm_info['date_of_birth_num'];?>">
                                                <input type="hidden" id="gender_code" name="impv_info2[gender_code]" value="<?php echo $adm_info['gender_code'];?>">

                                                <input type="hidden"  name="impv_addr2[addr_home_no]" value="<?php echo $addr_diff_info['addr_home_no'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_moo]" value="<?php echo $addr_diff_info['addr_moo'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_alley]" value="<?php echo $addr_diff_info['addr_alley'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_lane]" value="<?php echo $addr_diff_info['addr_lane'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_road]" value="<?php echo $addr_diff_info['addr_road'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_province]" value="<?php echo $addr_diff_info['addr_province'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_district]" value="<?php echo $addr_diff_info['addr_district'];?>">
                                                <input type="hidden"  name="impv_addr2[addr_sub_district]" value="<?php echo $addr_diff_info['addr_sub_district'];?>"> 
                                                    
                                                  
                                                  
                                                  <script>

                                                     setTimeout(icheck_loop,2000);

                                                    function icheck_loop () {

                                                      $('.i-checks').iCheck({
                                                        checkboxClass: 'icheckbox_square-green',
                                                        radioClass: 'iradio_square-green',
                                                        increaseArea: '20%'
                                                      });


                                                      // $("#elder_pers_chk").on('ifClicked',function(){
                                                      //   console.log(req_pers);
                                                      //   if(!$(this).prop('checked')) {
                                                      //     $("#elder_pid").val($("#req_pid").val());
                                                      //     $("#pid").val(req_pers.pid);
                                                      //     $("#pers_id").val(req_pers.pers_id);
                                                      //     $("#name").html(req_pers.name);
                                                      //     $("#date_of_birth").html(req_pers.date_of_birth);
                                                      //     $("#gender_name").html(req_pers.gender_name);
                                                      //     $("#nation_name_th").html(req_pers.nation_name_th);
                                                      //     $("#relg_title").html(req_pers.relg_title);
                                                      //     $("#reg_addr_id").val(req_pers.reg_addr_id);
                                                      //     $("#reg_addr").html(req_pers.reg_add_info);
                                                      //     $(".elder_same_req").attr('disabled',true);
                                                      //     check_of_dis();
                                                      //     notice_excep_age(req_pers.age);
                                                      //   }else {
                                                      //     $("#pid").val("");
                                                      //     $("#pers_id").val("");
                                                      //     $("#elder_name").html(" - ");
                                                      //     $(".elder_same_req").attr('disabled',false);
                                                      //     notice_excep_age(-1);
                                                      //   }
                                                      // });

                                                      <?php if( $addr_pers_info['addr_home_no']== $addr_info['addr_home_no'] 
                                                      && $addr_pers_info['addr_moo']== $addr_info['addr_moo'] 
                                                      && $addr_pers_info['addr_home_no'] != ""                                                       
                                                      ) { ?>
                                                        $("input[name='elder_addr_chk']").parent().addClass('checked');
                                                        $("input[name='elder_addr_chk']").prop('checked',true);
                                                        $(".elder_addr_pre").attr('disabled',true);

                                                      <?php } ?>

                                                       <?php
                                                            $tmp_dis = $this->common_model->custom_query("SELECT * FROM std_disability ORDER BY dis_code ASC");
                                                            foreach ($tmp_dis as $key => $value) {
                                                        ?>

                                                       $("input[name='pers_disability[dis_code][<?php echo $value['dis_code'] ?>]']").on('ifChanged',function(){

                                                         console.log($("input[name='pers_disability[dis_code][<?php echo $value['dis_code'] ?>]']").prop('checked'));

                                                         if($("input[name='pers_disability[dis_code][<?php echo $value['dis_code'] ?>]']").prop('checked')){
                                                           $("input[name='pers_disability[dis_remark][<?php echo $value['dis_code']; ?>]']").prop('disabled',false).focus();
                                                         }else{
                                                           $("input[name='pers_disability[dis_remark][<?php echo $value['dis_code']; ?>]']").prop('disabled',true);
                                                         }
                                                       });
                                                     <?php } ?>
                                                    };

                                                    var pers_of_dis_status = 0;
                                                    var check_of_dis = function (){
                                                          $.ajax({
                                                          url: '<?php echo site_url('welfare/pers_of_dis_status');?>/'+$("#pers_id").val(),
                                                          type: 'POST',
                                                          dataType: 'json',
                                                          data: {
                                                              pers_id: $("#pers_id").val(),
                                                              <?php echo $csrf['name'];?>: '<?php echo $csrf['hash'];?>'
                                                          },
                                                            success: function (value) {
                                                              //console.log("value:"+value);
                                                              pers_of_dis_status = value.dis_status;
                                                              if(pers_of_dis_status == 1){
                                                                console.log("value:"+value.goto_page);
                                                                //value.goto_page = 'welfare/inform1/Edit/11';
                                                                if(value.goto_page!=''){
                                                                    $("#disStatusStr").html("มีข้อมูลรับเข้าอยู่ในหน่วยงาน "+value.org_name+" แล้ว");
                                                                    $('#disStatusModel').modal('show');
                                                                    $('#disStatusYes').click(function() {//button
                                                                        window.location.replace(base_url+value.goto_page);
                                                                    });
                                                                    $('#disStatusNo').click(function() {//button
                                                                        $('#elder_pers_chk').iCheck('uncheck');
                                                                        $("#pid").val("");
                                                                        $("#elder_pid").val("");
                                                                        $("#name").html("-");

                                                                        $("#elder_name").html("-");
                                                                        $(".elder_same_req").attr('disabled',false);
                                                                        $('#disStatusModel').modal('hide');
                                                                    });
                                                                }else{
                                                                    $("#elder_pid").attr("title","ยังไม่ได้จำหน่ายออก จากหน่วยงาน"+value.org_name);
                                                                    $("#elder_pid").attr("data-original-title","ยังไม่ได้จำหน่ายออก จากหน่วยงาน"+value.org_name);
                                                                    $("#elder_pid").tooltip("show");
                                                                    $("#elder_pid").focus();
                                                                }
                                                              }

                                                            },
                                                            error:function() {
                                                              console.log("error");

                                                            },
                                                          });
                                                          


                                                    }

                                                  </script>
                                                  <!--
                                                  <button onclick="$('#integration').modal('show');return false;" class="btn btn-default" style="float: right;">ข้อมูลบูรณาการ</button>
                                                  -->
                                                </h4>
                                              </div>

                                              <div class="panel-body" style="border:0; padding: 20px; padding-bottom: 0px;">

                                                <div class="alert alert-danger alert-excep-age <?php echo ( isset($adm_info['age']) && $adm_info['age'] < 60 ? "" : "hide" ) ?>">
                                                  <strong>แจ้งเตือน!</strong> ศูนย์พัฒนาการจัดสวัสดิการสังคมผู้สูงอายุ ผู้สูงอายุจะต้องมีอายุมากกว่า 60 ปี
                                                </div>

                                                <div class="form-group row ">
                                                <div class="col-xs-12 col-sm-3" >                
                                                    <?php if($adm_info['adm_photo_file']!='') {?>
                                                              
                                                              <img src="<?php echo base_url().$adm_info['adm_photo_file'];?>?>" alt="..." class="image" >                              
                                                              <input type="file" name="img"  class="img_0" accept="image/*"  style="display: none;" onchange="imgchange(this,'');">
                                                              <button id="btnAddimg" type="button" class="btn btn-default" style="width: 138px;" onclick="brwImg(this,'');">เปลี่ยนรูปภาพ</button>
                                                    <?php }else{ ?>
                                                            <img src="<?php echo path('noProfilePic.jpg','member');?>" class="image" >                                                               
                                                              <input type="file" name="img"  class="img_0" accept="image/*"  style="display: none;" onchange="imgchange(this,'');">
                                                              <button id="btnAddimg" type="button" class="btn btn-default" style="width: 138px;" onclick="brwImg(this,'');">เพิ่มรูปภาพ</button>
                                                                  
                                                    <?php } ?>        
                                                </div>

                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold; color: red;">เลขประจำตัวประชาชน</span> </div>
                                                    <div class="col-xs-12 col-sm-6 has-error" style="padding: 3px 15px;">
                                                       <div class="input-group" style="width: 295px;">
                                                             <input  title="เลขประจำตัวประชาชน" placeholder="เลขประจำตัวประชาชน (13 หลัก)" class="form-control input_idcard elder_same_req" type="text" id="elder_pid" name="adm_info[pid]" value="<?php echo @$adm_info['pid'];?>" required/>
                                                          <div class="input-group-btn" style="padding-bottom: 5px;">
                                                             <button title="ตรวจสอบ" class="btn btn-default elder_same_req" type="button"  onClick="bt_elder_pid()"  style="background-color:#F2DEDE; border-radius: 0px; left: 1px; border-color: #ed5565; color: #ed5565;padding:5px 12px;"><i class="fa fa-search" aria-hidden="true"></i></button>
                                                          </div>
                                                       </div>
                                                       <input type="hidden" id="pid_id" name="diff_pid[pid]" value="<?php echo $adm_info['pid'];?>">
                                                        <input type="hidden" id="pers_id" name="diff_info[pers_id]" value="<?php echo $adm_info['pers_id'];?>">
                         
                                                      <!-- <input type="hidden" id="pers_id" name="adm_info[pers_id]" value="<?php echo @$adm_info['pers_id'];?>"> -->
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;" ><span style="font-weight: bold;">ชื่อตัว/ชื่อสกุล</span></div>
                                                    <div class="col-xs-12 col-sm-6" style="padding: 7px 15px;"  id="name_sufferer"><?php echo $adm_info['name'];?> </div>
                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">วันเดือนปีเกิด</span></div>
                                                    <div class="col-xs-12 col-sm-6" style="padding: 7px 15px;" id="date_of_birth_sufferer"><?php echo @$adm_info['date_of_birth'];?> </div>

                                                     <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">เพศ</span> <span id="gender_name_sufferer"><?php echo @$adm_info['gender_name'];?></span> </div>
                                                    <div class="col-xs-12 col-sm-3" style="padding: 7px 15px;"><span style="font-weight: bold;">สัญชาติ</span> <span id="nation_name_sufferer"><?php echo @$adm_info['nation_name_th'];?></span> </div>
                                                    <div class="col-xs-12 col-sm-6" style="padding: 7px 15px;"><span style="font-weight: bold;">ที่อยู่ตามทะเบียนบ้าน</span><input type="hidden" id="reg_addr_sufferer" name="pers_info[reg_addr_id]" value="<?php echo $adm_info['reg_addr_id']; ?>">
													<span id="reg_addr"><?php echo @$adm_info['reg_add_info']; ?></span>
													</div>  
                                                 </div>   
                                                    <!--
                                                      <script>
                                                        var elder_pers = null;
                                                        $("#bt_elder_pid").click(function(){

                                                          if($("#pid").val()!='') {

                                                            //$("#bt_elder_pid").html('<i class="fa fa-circle-o-notch fa-spin fa-1x fa-fw"></i><span> ตรวจสอบ</span>');
                                                            $("#bt_elder_pid").attr('disabled',true);

                                                            $.ajax({
                                                            url: '<?php echo site_url('personals/getPersonalInfo');?>',
                                                            type: 'POST',
                                                            dataType: 'json',
                                                            data: {
                                                                pid: $("#pid").val(),
                                                                <?php echo $csrf['name'];?>: '<?php echo $csrf['hash'];?>'
                                                            },
                                                              success: function (value) {
                                                                console.log("success");
                                                                console.dir(value);

                                                                elder_pers = value;

                                                                $("#name").html(value.name);
                                                                $("#date_of_birth").html(value.date_of_birth);
                                                                $("#gender_name").html(value.gender_name);
                                                                $("#nation_name_th").html(value.nation_name_th);
                                                                $("#relg_title").html(value.relg_title);
                                                                $("#pers_id").val(value.pers_id);
                                                                $("#bt_elder_pid").attr('disabled',false);
                                                              },
                                                              error:function() {
                                                                console.log("error");เบอร์โทรศัพท์ (ที่ติดต่อได้)
                                                                $("#bt_elder_pid").attr('disabled',false);
                                                              },
                                                            });

                                                          }else {
                                                            $("#pid").select();
                                                            $("#bt_elder_pid").attr('disabled',false);
                                                          }
                                                          //$("#pers_id").val('');
                                                        });
                                                      </script>
                                                      -->

                                                        <script>
                                                        // var elder_pers = null;
                                                        // var inputpid2 = "#elder_pid";
                                                        // var bt_spid2 = "#bt_elder_pid";
                                                        // var setData2 = "reqData2"; //Declear Name
                                                        // var reqData2 = function(value) { //Set Structure Display Data
                                                        //   elder_pers = value;
                                                        //   $("#name").html(value.name);
                                                        //   $("#date_of_birth").html(value.date_of_birth);
                                                        //   $("#gender_name").html(value.gender_name);
                                                        //   $("#nation_name_th").html(value.nation_name_th);
                                                        //   $("#relg_title").html(value.relg_title);
                                                        //   $("#pers_id").val(value.pers_id);
                                                        //   $("#reg_addr_id").val(value.reg_addr_id);
                                                        //   $("#reg_addr").html(value.reg_add_info);
                                                        //   notice_excep_age(value.age);
                                                        // }
                                                        // $(bt_spid2).click(function(){//On Click for Search
                                                        //   if($(inputpid2).val()!='') {//pid not null

                                                        //    $(bt_spid2).attr('disabled',true);

                                                        //     if(pers_authen!=null) { //Check Personal Authen
                                                        //       getPersInfo(inputpid2,bt_spid2,setData2,true); //Get Data
                                                        //       check_of_dis();
                                                        //     }else if(!reader_status) { //Run Reader Personal
                                                        //       run_readerPers();
                                                        //       $(bt_spid2).attr('disabled',false);
                                                        //       toastr.warning("ท่านยังไม่ได้ Authen เข้าใช้งานในฐานะเจ้าหน้าที่ ระบบกำลังเชื่อมโยงข้อมูลกับฐานข้อมูลหลัก","Authentications");
                                                        //     }

                                                        //   }else { //pid is null
                                                        //     $(inputpid2).select();
                                                        //   }
                                                        // });

                                                        function brwImg (node,myID){
                                                          $(node).prev().click();
                                                            //console.log($(node).prev());                                     
                                                        }

                                                        function imgchange(node,myID){

                                                                //var countFiles = $(this)[0].files.length;

                                                                var imgPath = $(node)[0].value;

                                                                var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase(); 
                                                                                                                                                                                                                  //Get count of selected files
                                                                //var image_holder = $("#image-holder");
                                                                //image_holder.empty();
                                                                $(node).prev().remove();
                                                                if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                                                                        if (typeof(FileReader) != "undefined") {
                                                                                //loop for each file selected for uploaded.
                                                                              //for (var i = 0; i < countFiles; i++) {
                                                                              var reader = new FileReader();

                                                                              reader.onload = function(e) {

                                                                              //console.log(e.target.result);
                                                                              
                                                                              var add_img = '<img src="'+e.target.result+'" class="image" >';

                                                                                $(node).before(add_img);

                                                                              }

                                                                              //  image_holder.show();
                                                                              reader.readAsDataURL($(node)[0].files[0]);

                                                                      }                     

                                                                      else {
                                                                        alert("This browser does not support FileReader.");
                                                                      }

                                                                    } else {
                                                                      alert("กรุณาเลือกไฟล์เป็นชนิด รูปภาพ");
                                                                    } 

                                                          }//close loop function


                                                      </script>

                                                      <!-- Info Modal -->
                                                        <div class="modal fade" id="integration" role="dialog">
                                                          <div class="modal-dialog" style="width: 1000px;">
                                                            <div class="modal-content">
                                                             <div class="modal-header" style="background-color: #eee">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h3 class="modal-title text-left">ผู้สูงอายุที่เข้าร่วม</h3>
                                                              </div>
                                                              <div class="modal-body">
                                                                <div style="font-size: 24px;color: #A7A7A7;margin-bottom: 10px; border-top: 1px solid #EDEDED;border-bottom: 1px solid #EDEDED;">
                                                                  ข้อมูลบูรณาการ
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ขึ้นทะเบียนผู้มีรายได้น้อย</label>
                                                                    <div>(กรมการปกครอง)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>วันที่ขึ้นทะเบียน</label>
                                                                    <div>20 สิงหาคม 2559</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>สถานะการได้รับความช่วยเหลือ</label>
                                                                    <div style="color: green;">ได้รับ</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label></label>
                                                                    <div></div>
                                                                  </div>
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ความจำเป็นพื้นฐาน (จปฐ.)</label>
                                                                    <div>(กรมการพัฒนาชุมชน)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>อาชีพ (ปัจจุบัน)</label>
                                                                    <div>เกษตรกร</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>รายได้เฉลี่ยน (บาท/เดือน)</label>
                                                                    <div style="color: #D1813F;">3,800</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ที่มาของรายได้</label>
                                                                    <div  style="color: green;">ด้วยตนเอง</div>
                                                                  </div>
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ทะเบียนจัดหางานผุ้สูงอายุ</label>
                                                                    <div>(กรมการจัดหางาน)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>วันที่ขึ้นทะเบียน</label>
                                                                    <div>16 มกราคม 2560</div>
                                                                  </div>

                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>สถานะการได้รับงาน</label>
                                                                    <div  style="color: green;">ได้งานทำแล้ว</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label></label>
                                                                    <div></div>
                                                                  </div>
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>กองทุนผู้สูงอายุ</label>
                                                                    <div>(กรมกิจการผู้สูงอายุ)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ประวัติการกู้ยืมกองทุน</label>
                                                                    <div style="color: green">มีประวัติ</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>สถานะสัญญากู้ยืม</label>
                                                                    <div style="color: #D1813F;">ยังมีสัญญา</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label></label>
                                                                    <div></div>
                                                                  </div>
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>การสงเคราะห์ผู้สูงอายุในภาวะยากลำบาก</label>
                                                                    <div>(กรมกิจการผู้สูงอายุ)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ประวัติการได้รับการสงเราะห์</label>
                                                                    <div style="color: green">เคยได้รับ</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ภายในรอบปีนี้ (ครั้ง)</label>
                                                                    <div style="color: red;">3 (ได้รับครบ 3 ครั้ง ภายในรอบ 1 ปี)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label></label>
                                                                    <div></div>
                                                                  </div>
                                                                </div>
                                                                <div class="row">
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ศูนย์พัฒนาการจัดสวัสดิการสังคมฯ</label>
                                                                    <div>(กรมกิจการผู้สูงอายุ)</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ประวัติการได้รับบริการ</label>
                                                                    <div style="color: green">เคยได้รับ</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ภายในรอบปีนี้ (ครั้ง)</label>
                                                                    <div style="color: #D1813F;">1</div>
                                                                  </div>
                                                                  <div class="col-xs-12 col-sm-3">
                                                                    <label>ศูนย์ที่รับเข้ารับบริการ (ล่าสุด)</label>
                                                                    <div>ศูนย์พัฒนาฯ บางละมุง (จำหน่ายแล้ว)</div>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                            </div>
                                                          </div>
                                                        </div>
                                                        <!-- End Info Modal -->
												
                                                  </div>

                                                  <div class="form-group row">

                    <div class="col-lg-12" id="integration1" hidden='hidden'>
                    <div class="ibox float-e-margins">
                        <div class="ibox-content" style="padding-bottom: 0px">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th style="background-color: #459597; color: #fff">ข้อมูลบูรณาการ</th>
                                        <th style="background-color: #459597; color: #fff">หน่วยงาน</th>
                                        <th style="background-color: #459597; color: #fff">รายละเอียด</th>
                                        <!-- <th style="background-color: #459597; color: #fff">#</th> -->
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!--
                                    <tr>
                                        <td>
                                            <label>ขึ้นทะเบียนผู้มีรายได้น้อย</label>
                                            <div style="font-size: 18px;">(กรมการปกครอง)</div>
                                        </td>
                                        <td>
                                            <label>วันที่ขึ้นทะเบียน</label>
                                            <div style="font-size: 18px;">-</div>
                                        </td>
                                        <td>
                                            <label>สถานะการได้รับความช่วยเหลือ</label>
                                            <div style="font-size: 18px; color: green;">-</div>
                                        </td>
                                        <td></td>
                                        <td><a href="#"><i class="fa fa-check text-navy"></i></a></td>
                                    </tr>
                                    -->
                                    <tr>
                                        <td>
                                            <b>อายุผู้ขอรับบริการ</b> <!--วัน/เดือน/ปี/เกิด : <span id="row1_date_of_birth">-</span> -->
                                        </td>
                                        <td>
                                          กรมการปกครอง
                                        </td>
                                        <td>
                                          <span id="age_status_txt">60 ปีขึ้นไป</span>
                                        </td>
                                        <!-- <td id="row1_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>สถานะการเสียชีวิต</b> วัน/เดือน/ปีเสียชีวิต : <span id="row2_date_of_death">-</span>
                                        </td>
                                        <td>
                                          กรมการปกครอง
                                        </td>
                                        <td>
                                        <span id="death_status_txt">มีชีวิตอยู่</span>
                                        </td>
                                        <!-- <td id="row2_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>ความจำเป็นพื้นฐาน (จปฐ.) : รายได้เฉลี่ย </b><span id="jpth_detail">-</span>
                                            <!-- <select class="form-control m-b" id="accountJPTH" style="overflow:auto;">
                                                <option>อาชีพ (ปัจจุบัน) : - รายได้เฉลี่ย - (บาท/เดือน) :  ที่มาของรายได้ : - </option>
                                            </select> -->
                                        </td>
                                        <td>
                                          กรมการพัฒนาชุมชน
                                        </td>
                                        <td>
                                        <span id="income_state"></span>
                                        </td>
                                        <!-- <td id="row3_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>ทะเบียนจัดหางานผุ้สูงอายุ</b> วันที่ขึ้นทะเบียน : <span id="row4_date_of_reg_th">-</span> สถานะการได้รับงาน : <span id="row4_reg_status">-</span>
                                        </td>
                                        <td>
                                            กรมการจัดหางาน
                                        </td>
                            
                                        <td>
                                            ไม่สามารถดึงข้อมูลได้
                                        </td>
                                        <!-- <td id="row4_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>กองทุนผู้สูงอายุ</b> ประวัติการกู้ยืมกองทุน : <span id="row5_loan_history">-</span> สถานะสัญญากู้ยืม : <span id="row5_contract_status">-</span>
                                        </td>
                                        <td>
                                          กรมกิจการผู้สูงอายุ
                                        </td>
                                    
                                        <td id="row5_state">ไม่พบข้อมูลประวัติการกู้ยืมกองทุน </td>
                                        <!-- <td id="row5_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>
                                    <!--
                                    <tr>
                                        <td>
                                            <b>การสงเคราะห์ผู้สูงอายุในภาวะยากลำบาก</b> ประวัติการได้รับการสงเคราะห์ : <span id="row6_history">-</span> ภายในรอบปีนี้ <span id="row6_year_now_history">-</span> (ครั้ง) :
                                        </td>
                                        <td>
                                          กรมกิจการผู้สูงอายุ
                                        </td>
                                        <td>
                                        </td>
                                        <td id="row6_state"><i class="fa fa-times text-danger"></i></td>
                                    </tr>
                                    -->

                                    <tr>
                                        <td>
                                            <b>ศูนย์พัฒนาการจัดสวัสดิการสังคมฯ</b> ประวัติการได้รับบริการ : <span id="row7_history">-</span> ภายในรอบปีนี้ <span id="row7_year_now_history">-</span> (ครั้ง) ศูนย์ที่รับเข้ารับบริการ (ล่าสุด) : <span id="row7_req_org">-</span>
                                        </td>
                                        <td>
                                          กรมกิจการผู้สูงอายุ
                                        </td>
                                        <td id="row7_state">ตรวจสอบข้อมูลเสร็จสิ้น</td>
                                        </td>
                                        <!-- <td id="row7_state"><i class="fa fa-times text-danger"></i></td> -->
                                    </tr>

                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>

                                                    <div class="col-xs-12 col-sm-6">ที่อยู่ (ปัจจุบัน) ( <div class="checkbox-inline i-checks"><label><input type="checkbox" name="elder_addr_chk" id="elder_addr_chk"> ตรงกับที่อยู่ตามทะเบียนบ้าน</label></div> )</div>

                                                    <div class="col-xs-12 col-sm-6">

                                                      <?php
                                                            $addr_gps = @$addr_info['addr_gps']; // Old Data $diff_info['addr_gps']

                                                            if($addr_gps=='') {
                                                              $addr_gps ='0,0'; // Set Default Data
                                                            }
                                                            $arr = explode(',',$addr_gps);
                                                          ?>

                                                          <script type="text/javascript">
                                                            var latitude = '<?php echo $arr[0];?>';
                                                            var longitude = '<?php echo $arr[1];?>';


                                                            //var latitude_center = latitude=='0'?'13.5847536':latitude;
                                                            //var longitude_center = longitude=='0'?'13.5847536':longitude;
                                                            var marker_img = '<?php echo path('map-marker.png','webconfig');?>';
                                                            if(latitude!='0' && longitude!='0') {
                                                              setTimeout(function(){
                                                                $("#lat_value").val(latitude);  // เอาค่า latitude ตัว marker แสดงใน textbox id=lat_value
                                                                $("#lon_value").val(longitude);  // เอาค่า longitude ตัว marker แสดงใน textbox id=lon_value
                                                                //$("#zoom_value").val(map.getZoom());  // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_valu

                                                              },1500);
                                                            }

                                                          </script>

                                                           <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal_marker">
                                                              <i class="fa fa-map-marker" aria-hidden="true"></i> ตำแหน่งพิกัดภูมิศาสตร์
                                                             </button>

                                                            &nbsp;
                                                              <input type="hidden" name="pers_addr[addr_gps]" value="<?php echo $addr_gps;?>" id="addr_gps">
                                                              <span id="addr_gpg_txt"><?php if($addr_gps!='0,0') { echo '('.$addr_gps.')';}?></span>

                                                      </div>
                                                  </div>

                                                  <div class="form-group row">
                                                          <div class="col-xs-12 col-sm-6 dropdown">
                                                              <label for="example-text-input" class="col-2 col-form-label">สถานะการพักอาศัย</label>
                                                              <div class="col-10">
                                                                <select title="สถานะการพักอาศัย" placeholder="เลือกสถานะการพักอาศัย" class="form-control" name="pers_info[pre_addr_status]">
                                                                    <option value="">เลือกสถานะการพักอาศัย</option>
                                                                    <option value="บ้านตนเอง"     <?php if(@$adm_info['pre_addr_status'] == 'บ้านตนเอง'){ echo "selected";} ?>>บ้านตนเอง</option>
                                                                    <option value="อาศัยผู้อื่นอยู่"   <?php if(@$adm_info['pre_addr_status'] == 'อาศัยผู้อื่นอยู่'){ echo "selected";} ?>>อาศัยผู้อื่นอยู่</option>
                                                                    <option value="บ้านเช่า"      <?php if(@$adm_info['pre_addr_status'] == 'บ้านเช่า'){ echo "selected";} ?>>บ้านเช่า</option>
                                                                    <option value="อยู่กับผู้จ้าง"    <?php if(@$adm_info['pre_addr_status'] == 'อยู่กับผู้จ้าง'){ echo "selected";} ?>>อยู่กับผู้จ้าง</option>
                                                                    <option value="ไม่มีที่อยู่อาศัยเป็นหลักแหล่ง" <?php if(@$adm_info['pre_addr_status'] == 'ไม่มีที่อยู่อาศัยเป็นหลักแหล่ง'){ echo "selected";} ?>>ไม่มีที่อยู่อาศัยเป็นหลักแหล่ง</option>
                                                                </select>
                                                            </div>
                                                          </div>

                                                          <div class="col-xs-12 col-sm-3">
                                                                  <label class="col-2 col-form-label" style="color:red;">บ้านเลขที่</label>
                                                                  <input type="hidden" name="pre_addr_id" value="<?php echo @$adm_info['pre_addr_id']; ?>">
                                                                  <input type="hidden" name="addr_home_id" value="<?php echo @$addr_info['addr_home_no']; ?>">
                                                                  <input title="บ้านเลขที่" placeholder="ตัวอย่าง xxx/xx" style="border-color:red;" class="form-control elder_addr_pre" onkeyup="nonthnumber(this)" type="text" name="pers_addr[addr_home_no]" id="addr_home_no" value="<?php echo @$addr_info['addr_home_no']; ?>" required/>
                                                          </div>

                                                          <div class="col-xs-12 col-sm-3">
                                                                <label class="col-2 col-form-label">หมู่ที่</label>
                                                                <input type="hidden" name="addr_moo_id" value="<?php echo @$addr_info['addr_moo']; ?>">
                                                                  <input title="หมู่ที่" placeholder="" class="form-control elder_addr_pre" onkeyup="housenumber(this)"  type="text" name="pers_addr[addr_moo]" id="addr_moo" value="<?php echo @$addr_info['addr_moo']; ?>"/>
                                                          </div>
                                                  </div>

                                                  <div class="form-group row">
                                                        <div class="col-xs-12 col-sm-3 dropdown">
                                                              <label for="example-text-input" class="col-2 col-form-label">ตรอก</label>
                                                              <div class="col-10">
                                                                <input id="alley" title="ตรอก" placeholder="ตัวอย่าง บ้านหล่อ" onkeyup="nonthnumandeng(this)" class="form-control elder_addr_pre" type="text" name="pers_addr[addr_alley]" id="addr_alley" value="<?php echo @$addr_info['addr_alley']; ?>" />
                                                              </div>
                                                        </div>
                                                        <div class="col-xs-12 col-sm-3">
                                                                <label for="example-text-input" class="col-2 col-form-label">ซอย</label>
                                                                <div class="col-10">
                                                                  <input id="lane" title="ซอย" placeholder="ตัวอย่าง วรพงษ์" onkeyup="addressvalidate(this)" class="form-control elder_addr_pre" type="text" id="addr_lane" name="pers_addr[addr_lane]" value="<?php echo @$addr_info['addr_lane']; ?>" />
                                                                </div>
                                                        </div>
                                                        <div class="col-xs-12 col-sm-6">
                                                                <label for="example-text-input" class="col-2 col-form-label">ถนน</label>
                                                                <div class="col-10">
                                                                  <input id="road" title="ถนน" placeholder="ตัวอย่าง ปรินายก" onkeyup="nonthnumandeng(this)" class="form-control elder_addr_pre" type="text" id="addr_road" name="pers_addr[addr_road]" value="<?php echo @$addr_info['addr_road']; ?>" />
                                                                </div>
                                                        </div>
                                                  </div>
                                                  
                                                  <div class="form-group row">
                                                  <div class="col-xs-12 col-sm-3 dropdown">
                                                            <label for="example-text-input" class="col-2 col-form-label" style="color:red;">จังหวัด</label>
                                                            <div class="col-10">
                                                            <select title="จังหวัด" placeholder="เลือกจังหวัด" class="form-control elder_addr_pre" id="Province" name="pers_addr[addr_province]" onchange="optionGen(this,'Amphur',<?php echo @$addr_info['district_code']; ?>);" required>
                                                                <option value="">เลือกจังหวัด</option>
                                                                <?php $temp = $this->personal_model->getAll_Province();
                                                                  foreach ($temp as $key => $row) { ?>
                                                        
                                                                    <option value="<?php echo $row['area_code']; ?>" ><?php echo $row['area_name_th']; ?></option>
                                                                    <?php  } ?>
                                                            </select>
                                                          </div>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3 dropdown">
                                                        <label for="example-text-input" class="col-2 col-form-label" style="color:red;">อำเภอ</label>
                                                        <div class="col-10">
                                                          <select title="อำเภอ" placeholder="เลือกอำเภอ" class="form-control elder_addr_pre" id="Amphur" name="pers_addr[addr_district]" onchange="optionGen(this,'Tambon',<?php echo @$addr_info['sub_district_code']; ?>);" disabled required>
                                                              <option value="">เลือกอำเภอ</option>
                                                              <?php $temp = $this->personal_model->getAll_Amphur();
                                                                foreach ($temp as $key => $row) { ?>
                                                                <option <?php if(@$addr_info['sub_district_code']==$row['area_code']){?> selected<?php }?> value="<?php echo $row['area_name_th'];?>"><?php echo $row['area_name_th'];?></option>
                                                                <!-- <option value="<?php echo $row['area_code']; ?>"><?php echo $row['area_name_th']; ?></option> -->
                                                              <?php  } ?>
                                                          </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3 dropdown">
                                                        <label for="example-text-input" class="col-2 col-form-label" style="color:red;">ตำบล</label>
                                                        <div class="col-10">
                                                        <select title="ตำบล" placeholder="เลือกตำบล" class="form-control elder_addr_pre" id="Tambon" name="pers_addr[addr_sub_district]" disabled required>
                                                            <option value="">เลือกตำบล</option>
                                                            <?php //$temp = $this->personal_model->getAll_Tambon();
                                                              //foreach ($temp as $key => $row) { ?>
                                                              <!-- <option value="<?php //echo $row['area_code']; ?>"><?php //echo $row['area_name_th']; ?></option> -->
                                                            <?php  //} ?>
                                                        </select>
                                                        </div>
                                                    </div>
   
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">รหัสไปรษณีย์</label>
                                                        <input title="รหัสไปรษณีย์" placeholder="ระบุรหัสไปรษณีย์ (5 หลัก)" class="form-control elder_addr_pre" maxlength="5" id="addr_zipcode" onkeyup="numbervalid(this)" type="text" name="pers_addr[addr_zipcode]" value="<?php echo @$addr_info['addr_zipcode']; ?>"/>
                                                    </div>
                                                  </div>

                                                  <div class="form-group row">
                                                    <div class="col-xs-12 col-sm-3">
                                                      <label class="col-2 col-form-label">เบอร์โทรศัพท์ (ที่ติดต่อได้)</label>
                                                      <input title="เบอร์โทรศัพท์ (ที่ติดต่อได้)" placeholder="ตัวอย่าง 08XXXXXXXX" class="form-control" maxlength="10" onkeyup="thnodash(this)" type="text" name="pers_info[tel_no]" value="<?php echo @$adm_info['tel_no'];?>"/>
                                                    </div>

                                                    <div class="col-xs-12 col-sm-3">
                                                      <label for="" class="col-2 col-form-label">ที่อยู่อีเมล</label>
                                                      <input title="ที่อยู่อีเมล" placeholder="ตัวอย่าง me@mail.com" class="form-control" onkeyup="nonthai(this)" type="email" name="pers_info[email_addr]" value="<?php echo @$adm_info['email_addr'];?>"/>
                                                    </div> 

                                                    <div class="col-xs-12 col-sm-3 dropdown"> 
                                                      <label for="example-text-input" class="col-2 col-form-label">สถานะการสมรส</label>
                                                      <div class="col-10">
                                                        <select title="สถานะการสมรส" placeholder="เลือกสถานะการสมรส" class="form-control" name="pers_info[marital_status]">
                                                          <option value="">เลือกสถานะการสมรส</option>
                                                          <option value="โสด"                <?php if(@$adm_info['marital_status']  == 'โสด')         { echo "selected"; } ?> >   โสด</option>
                                                          <option value="สมรส อยู่ด้วยกัน"       <?php if(@$adm_info['marital_status'] == 'สมรส อยู่ด้วยกัน'){ echo "selected"; } ?> >   สมรส อยู่ด้วยกัน</option>
                                                          <option value="สมรส แยกกันอยู่"       <?php if(@$adm_info['marital_status'] == 'สมรส แยกกันอยู่'){ echo "selected"; } ?>>    สมรส แยกกันอยู่</option>
                                                          <option value="หย่าร้าง"              <?php if(@$adm_info['marital_status'] == 'หย่าร้าง')       { echo "selected"; } ?>>    หย่าร้าง</option>
                                                          <option value="ไม่ได้สมรส แต่อยู่ด้วยกัน" <?php if(@$adm_info['marital_status'] == 'ไม่ได้สมรส แต่อยู่ด้วยกัน'){ echo "selected"; } ?>>ไม่ได้สมรส แต่อยู่ด้วยกัน</option>
                                                          <option value="หม้าย (คู่สมรสเสียชีวิต)" <?php if(@$adm_info['marital_status'] == 'หม้าย (คู่สมรสเสียชีวิต)'){ echo "selected"; } ?>>หม้าย (คู่สมรสเสียชีวิต)</option>
                                                        </select>
                                                      </div>
                                                    </div>

                                                    <div class="col-xs-12 col-sm-3 dropdown">
                                                      <label for="example-text-input" class="col-2 col-form-label">ระดับการศึกษา</label>
                                                      <div class="col-10">
                                                        <select title="ระดับการศึกษา" placeholder="เลือกระดับการศึกษา" class="form-control" name="pers_info[edu_code]">
                                                          <option value="">เลือกระดับการศึกษา</option>
                                                          <?php $temp = $this->personal_model->getAll_edu_level();
                                                          foreach ($temp as $key => $row) { ?>
                                                          <option value="<?php echo $row['edu_code']; ?>" <?php if(@$adm_info['edu_code'] == $row['edu_code']){ echo "selected"; } ?>> <?php echo $row['edu_title']; ?></option>
                                                          <?php  } ?>
                                                        </select>
                                                      </div>
                                                    </div>



                                                  </div>


                                                  <div class="form-group row">
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">อาชีพ (ปัจจุบัน)</label>
                                                        <select id="occupation" title="อาชีพ (ปัจจุบัน)" placeholder="เลือกอาชีพ" class="form-control" name="pers_info[occupation]">
                                                        <option value="">เลือกอาชีพ</option>
                                                        <option value="ค้าขาย" <?php if(@$adm_info['occupation'] == 'ค้าขาย'){ echo "selected"; } ?>>ค้าขาย</option>
                                                        <option value="แม่บ้าน" <?php if(@$adm_info['occupation'] == 'แม่บ้าน'){ echo "selected"; } ?>>แม่บ้าน</option>
                                                        <option value="รับจ้าง" <?php if(@$adm_info['occupation'] == 'รับจ้าง'){ echo "selected"; } ?>>รับจ้าง</option>
                                                        <option value="เกษตรกรรม" <?php if(@$adm_info['occupation'] == 'เกษตรกรรม'){ echo "selected"; } ?>>เกษตรกรรม</option>
                                                        <option value="ไม่ได้ทำงาน"<?php if(@$adm_info['occupation'] == 'ไม่ได้ทำงาน'){ echo "selected"; } ?>>ไม่ได้ทำงาน</option>
                                                        <option value="อื่นๆ" <?php if(@$adm_info['occupation'] == 'อื่นๆ'){ echo "selected"; } ?>>อื่นๆ</option>
                                                      </select>       
                                                    
                                                    </div>
                                                    <script type="text/javascript">
                                                      $("#occupation").change(function () {
                                                        if($(this).val() == "อื่นๆ"){
                                                          $("#other_occupation").prop('disabled', false ).focus();
                                                        }else{
                                                          $("#other_occupation").val('');
                                                          $("#other_occupation").prop('disabled', true );
                                                        }
                                                      });
                                                    

                                                  </script>
                                                  <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">อาชีพอื่นๆ (ระบุ)</label>
                                                        <input id="other_occupation" title="ระบุ" onkeyup="thvalidate(this)" placeholder="ระบุ" class="form-control" type="text" name="pers_info[other_occupation]" value="<?php echo @$adm_info['other_occupation']; ?>"/>
                                                  </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">รายได้เฉลี่ย (บาท/เดือน)</label>
                                                        <input title="รายได้เฉลี่ย (บาท/เดือน)" onkeyup="numberndot(this)" placeholder="ระบุรายได้เฉลี่ย (บาท/เดือน)" class="form-control" type="type" name="pers_info[mth_avg_income]" value="<?php echo @$adm_info['mth_avg_income'];?>" />
                                                    </div>
                                                    </div>

                                                    <div class="form-group row">  
                                                    <div class="col-xs-12 col-sm-3 dropdown">
                                                        <label for="example-text-input" class="col-2 col-form-label">ที่มาของรายได้</label>
                                                        <div class="col-10">
                                                        <select title="ที่มาของรายได้" placeholder="เลือกที่มาของรายได้" class="form-control" name="pers_info[src_of_income]">
                                                        <option value="">เลือกที่มาของรายได้</option>
                                                        <option value="ด้วยตนเอง" <?php if($adm_info['src_of_income'] == 'ด้วยตนเอง'){ echo "selected"; } ?>>ด้วยตนเอง</option>
                                                        <option value="ผู้อื่นให้"   <?php if($adm_info['src_of_income'] == 'ผู้อื่นให้'){ echo "selected"; } ?>>ผู้อื่นให้</option>
                                                        <option value="อื่น ๆ"    <?php if($adm_info['src_of_income'] == 'อื่น ๆ'){ echo "selected"; } ?>>อื่น ๆ</option>
                                                        </select>
                                                      </div>
                                                    </div>

                                                    <div class="col-xs-12 col-sm-3">
                                                        <label class="col-2 col-form-label">ที่มาของรายได้อื่นๆ (ระบุ)</label>
                                                        <input title="ระบุ" placeholder="ระบุ" class="form-control" type="text"  onkeyup="nonthnumandeng(this)" name="pers_info[src_of_income_identify]" value="<?php echo @$adm_info['src_of_income_identify']; ?>"/>
                                                    </div>
                                                  </div>



                      <div class="form-group row">

                       <div class="col-xs-12 col-sm-12">
                        <?php $count = count(@$pers_family); ?>
                        <label>สมาชิกในครอบครัว (จำนวน <span id="nums_family_members"><?php echo $count; ?></span> คน)</label>
                      </div>

                        <script>
                        var nummf = <?php echo $count; ?>;
                        function btDel_family_members(node) {
                        $(node).parent().parent().parent().parent().remove();
                        $("#nums_family_members").html($(".family_members .family_members_items").length);
                        }
                        </script>

                        <div class="col-xs-12 col-sm-12">
                          <div class="family_members" >
                            <?php if(!empty($pers_family)){ ?>
                            <?php foreach ($pers_family as $key => $row) { ?>
                            <?php //dieArray($row); ?>
                            <div class="panel-group family_members_items" style="margin-top: -10px;">
                              <div class="panel panel-default" style="border: 0">

                                <div class="panel-body" style="background-color:#FBFBFB;border: 1px #eee solid; padding: 15px;">
                                  <div class="row text-right">
                                    <button type="button" class="btn btn-default delfamily_members" onclick="btDel_family_members(this)" style="margin-right: 16px;"><i class="fa fa-minus" aria-hidden="true"></i></button>
                                  </div>
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label" style="font-weight: bold; color: red;" >เลขบัตรประจำตัวประชาชน</label>
                                      <input  id="pid_<?php echo $key;?>" value="<?php echo $row['fml_pid'];?>" style="border-color:red;" title="เลขบัตรประจำตัวประชาชน" placeholder="เลขบัตรประจำตัวประชาชน (13 หลัก)" class="form-control input_idcard" type="text" name="pers_family[fml_pid][<?php echo $key;?>]"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3 dropdown">
                                      <label for="example-text-input" class="col-2 col-form-label">คำนำหน้านาม</label>
                                      <div class="col-10">
                                        <select title="คำนำหน้านาม" placeholder="เลือกคำนำหน้านาม" class="form-control" name="pers_family[pren_code][<?php echo $key;?>]">
                                          <option value="">เลือกคำนำหน้านาม</option>
                                          <?php
                                          $tmps = $this->common_model->custom_query("select * from std_prename");
                                          foreach ($tmps as $key1 => $value) {
                                            ?>
                                            <option <?php if(@$row['pren_code']==$value['pren_code']){?> selected<?php }?> value="<?php echo $value['pren_code'];?>"><?php echo $value['prename_th'];?></option>
                                            <?php
                                          }
                                          ?>
                                        </select>
                                      </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">ชื่อตัว</label>
                                      <input title="ชื่อตัว" placeholder="ระบุชื่อตัว" class="form-control " type="text" onkeyup="thvalidate(this)" name="pers_family[pers_firstname_th][<?php echo $key;?>]" value="<?php echo @$row['pers_firstname_th'];?>"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">ชื่อสกุล</label>
                                      <input title="ชื่อสกุล" placeholder="ระบุชื่อสกุล" class="form-control" type="text" onkeyup="thvalidate(this)" name="pers_family[pers_lastname_th][<?php echo $key;?>]" value="<?php echo @$row['pers_lastname_th'];?>"/>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">อายุ (ปี)</label>
                                      <input title="อายุ" id="pers_age_<?php echo $key;?>" placeholder="ระบุอายุ (ปี)" onkeyup="numbervalid(this)"  class="form-control" type="text" name="pers_family[fml_age][<?php echo $key;?>]" value="<?php echo @$row['fml_age'];?>" />
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">เกี่ยวของเป็น</label>
                                      <input title="ความสัมพันธ์กับผู้สูงอายุ" placeholder="ระบุความสัมพันธ์กับผู้สูงอายุ" onkeyup="numberandth(this)" class="form-control" type="text" name="pers_family[fml_relation][<?php echo $key;?>]" value="<?php echo $row['fml_relation'];?>"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">อาชีพ</label>
                                      <input title="อาชีพ" placeholder="ระบุอาชีพ" class="form-control" type="text" onkeyup="thvalidate(this)" id="occupation_<?php echo $key;?>" name="pers_family[occupation][<?php echo $key;?>]" value="<?php echo $row['occupation'];?>"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">รายได้เฉลี่ย (บาท/เดือน)</label>
                                      <input title="รายได้เฉลี่ย" placeholder="ระบุรายได้เฉลี่ย (บาท/เดือน)" class="form-control" onkeyup="numberndot(this)" type="text" id="mth_avg_income_<?php echo $key;?>" name="pers_family[mth_avg_income][<?php echo $key;?>]" value="<?php echo $row['mth_avg_income'];?>"/>
                                    </div>
                                  </div><!--end form group-->
                                  
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">เบอร์โทรศัพท์ (บ้าน)</label>
                                      <input title="อายุ" id="pers_age_myID" placeholder="ตัวอย่าง 02XXXXXXX ต่อ XXX" class="form-control" onkeyup="thnodash(this)" type="text" id="fml_tel_no_home_<?php echo $key;?>" value="<?php echo $row['fml_tel_no_home'];?>" name="pers_family[fml_tel_no_home][<?php echo $key;?>]"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                      <label class="col-2 col-form-label">เบอร์โทรศัพท์ (มือถือ)</label>
                                      <input title="อายุ" id="pers_age_myID" placeholder="ตัวอย่าง 08XXXXXXXX" maxlength="10" class="form-control" onkeyup="numbervalid(this)" type="text" id="fml_tel_no_<?php echo $key;?>" value="<?php echo $row['fml_tel_no'];?>" name="pers_family[fml_tel_no][<?php echo $key;?>]"/>
                                    </div>
                                      
                                  </div>
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-6">
                                      <label class="col-2 col-form-label">ปัญหาสุขภาพ</label>&nbsp;&nbsp;
                                      <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][<?php echo $key;?>]" value="ปกติ" <?php if($row['healthy'] == 'ปกติ'){ echo "checked";} ?>><i></i> ปกติ</label></div>&nbsp;&nbsp;&nbsp;
                                      <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][<?php echo $key;?>]" value="ผู้ป่วยเรื้อรัง" <?php if($row['healthy'] == 'ผู้ป่วยเรื้อรัง'){ echo "checked";} ?>><i></i> ผู้ป่วยเรื้อรัง</label></div>&nbsp;&nbsp;&nbsp;
                                      <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy][<?php echo $key;?>]" value="ผู้พิการ" <?php if($row['healthy'] == 'ผู้พิการ'){ echo "checked";} ?>><i></i> ผู้พิการ</label></div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6">
                                      <label class="col-2 col-form-label">ช่วยเหลือตนเอง</label>&nbsp;&nbsp;
                                      <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy_self_help][<?php echo $key;?>]" value="ได้" <?php if($row['healthy_self_help'] == 'ได้'){ echo "checked";} ?>><i></i> ได้</label></div>&nbsp;&nbsp;&nbsp;
                                      <div class="checkbox-inline i-checks"><label><input type="radio" name="pers_family[healthy_self_help][<?php echo $key;?>]" value="ไม่ได้" <?php if($row['healthy_self_help'] == 'ไม่ได้'){ echo "checked";} ?>><i></i> ไม่ได้</label></div>
                                    </div>
                                  </div><!--end form group-->
                                  <div class="form-group row">
                                    <div class="col-xs-12 col-sm-6">
                                        <label class="col-2 col-form-label">สถานะการพักอาศัย</label>
                                        <select title="สานะการพักอาศัย" placeholder="เลือกสถานะการพักอาศัย" class="form-control" name="pers_family[fml_pre_addr_status][<?php echo $key;?>]">
                                                      <option value="">เลือกสถานะการพักอาศัย</option>
                                                      <option value="บ้านตนเอง" <?php if($row['fml_pre_addr_status'] == 'บ้านตนเอง'){ echo "selected";} ?>>บ้านตนเอง</option>
                                                      <option value="อาศัยผู้อื่นอยู่" <?php if($row['fml_pre_addr_status'] == 'อาศัยผู้อื่นอยู่'){ echo "selected";} ?>>อาศัยผู้อื่นอยู่</option>
                                                      <option value="บ้านเช่า" <?php if($row['fml_pre_addr_status'] == 'บ้านเช่า'){ echo "selected";} ?>>บ้านเช่า</option>
                                                      <option value="อยู่กับผู้จ้าง" <?php if($row['fml_pre_addr_status'] == 'อยู่กับผู้จ้าง'){ echo "selected";} ?>>อยู่กับผู้จ้าง</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">บ้านเลขที่</label>
                                        <input title="บ้านเลขที่"  placeholder="ตัวอย่าง xxx/xxx"  onkeyup="nonthnumber(this)" class="form-control" type="text" name="pers_family[fml_addr_home_no][<?php echo $key;?>]" value="<?php echo $row['fml_addr_home_no'];?>"/>
                                    </div>
                                    <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">หมู่ที่</label>
                                        <input title="หมู่ที่" class="form-control" onkeyup="housenumber(this)" type="text" name="pers_family[fml_addr_moo][<?php echo $key;?>]" value="<?php echo $row['fml_addr_moo'];?>"/>
                                    </div>

                                   </div><!--end form group-->        
                                   <div class="form-group row">
                                      <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">ตรอก</label>
                                        <input title="ตรอก" placeholder="ตัวอย่าง บ้านหล่อ" class="form-control" type="text" onkeyup="nonthnumandeng(this)" name="pers_family[fml_addr_alley][<?php echo $key;?>]" value="<?php echo $row['fml_addr_alley'];?>" />
                                      </div>
                                      <div class="col-xs-12 col-sm-3">
                                        <label class="col-2 col-form-label">ซอย</label>
                                        <input title="ซอย"  placeholder="ตัวอย่าง วรพงษ์" class="form-control" type="text" onkeyup="addressvalidate(this)" name="pers_family[fml_addr_lane][<?php echo $key;?>]" value="<?php echo $row['fml_addr_lane'];?>"/>
                                      </div>
                                      <div class="col-xs-12 col-sm-6">
                                        <label class="col-2 col-form-label">ถนน</label>
                                        <input title="ถนน" placeholder="ตัวอย่าง ปรินายก" class="form-control" onkeyup="nonthnumandeng(this)" type="text" name="pers_family[fml_addr_road][<?php echo $key;?>]" value="<?php echo $row['fml_addr_road'];?>"/>
                                      </div>
                                  </div><!--end form group-->    
                                  <div class="form-group row">
                                      
                                        <div class="col-xs-12 col-sm-3">
                                          <label class="col-2 col-form-label">จังหวัด</label>
                                          <select title="จังหวัด" placeholder="เลือกจังหวัด" class="form-control" name="pers_family[fml_addr_province][<?php echo $key;?>]" onchange="optionGen2(this,'fml_amphur',<?php echo @$addr_info['fml_addr_province']; ?>);">
                                              <option value="">เลือกจังหวัด</option>
                                              <?php $temp = $this->personal_model->getAll_Province();
                                                    foreach ($temp as $keyinfo => $info) {  ?>
                                                      <option <?php if(@$row['fml_addr_province']==$info['area_name_th']){?> selected<?php }?> value="<?php echo $info['area_name_th'];?>"><?php echo $info['area_name_th'];?></option>
                                                      <?php } ?>
                                          </select>
                                        </div>

                                        <div class="col-xs-12 col-sm-3">
                                          <label class="col-2 col-form-label">อำเภอ</label>
                                          <select title="อำเภอ" placeholder="เลือกอำเภอ" class="form-control"  name="pers_family[fml_addr_district][<?php echo $key;?>]" onchange="optionGen2(this,'fml_tambon',<?php echo @$addr_info['fml_addr_district']; ?>);" >
                                          <option value="">เลือกอำเภอ</option>
                                            <?php $temp = $this->personal_model->getAll_Amphur();
                                                foreach ($temp as $keyinfo => $info) { ?>
                                                
                                                <option <?php if(@$row['fml_addr_district']==$info['area_name_th']){?> selected<?php }?> value="<?php echo $info['area_name_th'];?>"><?php echo $info['area_name_th'];?></option>
                                                
                                                <?php  } ?>
                                          </select>         
                                      </div>
                                      <div class="col-xs-12 col-sm-3">
                                          <label class="col-2 col-form-label">ตำบล</label>
                                          <select title="ตำบล" placeholder="เลือกตำบล" class="form-control" name="pers_family[fml_addr_sub_district][<?php echo $key;?>]" value="<?php echo @$addr_info['fml_addr_district']; ?>">
                                          <option value="">เลือกตำบล</option>
                                            <?php $temp = $this->personal_model->getAll_Tambon();
                                                foreach ($temp as $keyinfo => $info) { ?>
                                                <option <?php if(@$row['fml_addr_sub_district']==$info['area_name_th']){?> selected<?php }?> value="<?php echo $info['area_name_th'];?>"><?php echo $info['area_name_th'];?></option>
                                    
                                                <?php  } ?>
                                          </select>
                                    </div>

                                        <div class="col-xs-12 col-sm-3">
                                          <label class="col-2 col-form-label">รหัสไปรษณีย์</label>
                                          <input title="รหัสไปรษณีย์" placeholder="ระบุรหัสไปรษณีย์ 5 หลัก" class="form-control" onkeyup="numbervalid(this)" maxlength="5"  type="text" name="pers_family[fml_addr_zipcode][<?php echo $key;?>]" value="<?php echo $row['fml_addr_zipcode'];?>"/>
                                        </div>     
                                  </div><!--end form group-->
                           
                                  
                                  </div>              

                                </div>
                              </div>
                            </div>
                            <?php } ?>
                            <?php } ?>
                          </div>
                        </div>

                        
                        <div class="col-xs-12 col-sm-12">
                          <button type="button" class="btn btn-default" id="btAdd_family_members" style="margin-top: 4px;"><i class="fa fa-plus" aria-hidden="true"></i></button>
                        </div>
                        <script>
                        var cloneTmp = $('.family_members_template').clone();
                        // setTimeout(function(){addFmlyMember();},500);
                        function addFmlyMember() {
                        var cloneTmp1 = cloneTmp.html().replace(new RegExp("myID", 'g'), nummf);

                        setTimeout(function(){
                          $("#pid_"+(nummf-1)).mask("9-9999-99999-99-9");
                          $("#pren_code_"+(nummf-1)).select2();
                          //alert("#pid_"+(nummf-1));
                        },1000);

                        nummf = nummf+1;
                        $(cloneTmp1).clone().appendTo('.family_members');
                        $("#nums_family_members").html($(".family_members .family_members_items").length);
                        $('.i-checks').iCheck({
                            checkboxClass: 'icheckbox_square-green',
                            radioClass: 'iradio_square-green',
                            increaseArea: '20%'
                          });
                        }
                        $("#btAdd_family_members").click(function(){ //Add

                        addFmlyMember();
                        //icheck_loop();
                        });
                        </script>
                      </div>

                                                      <div class="form-group row" style="margin-top: 5px">
                                                      <!-- panel group ข้อมูลกายภาพ -->
                                                      <div class="panel-group" style="margin-bottom: 0px;">
                                                            <div class="panel panel-default" style="border:0">
                                                                <div class="panel-heading"><h4>ข้อมูลกายภาพ</h4></div>

                                                                <div class="panel-body" style="border:1;padding: 20px; padding-bottom: 0px;">
                                                                       <div class="form-group row" style="margin-bottom: 10px;">
                                                                            <div class="col-xs-12 col-sm-12" > 
                                                                                  <div class="form-group row"><!-- row leverl 2-->
                                                                                      <div class="col-xs-12 col-sm-12"><b><u>บุคลิกลักษณ์ </u></b></div>
                                                                        
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" style="padding-left: 60px;" ><div class="text"><label>1. ใบหน้า</label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" placeholder="ระบุ" onkeyup="numberandth(this)" name="pers_physicality[phy_face_detail]" value="<?php echo @$pers_physicality['phy_face_detail']; ?>" /></div>
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" style="padding-left: 60px;"><div class="text"><label>2. สีผิว</label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" placeholder="ระบุ" onkeyup="numberandth(this)" name="pers_physicality[phy_skin_detail]" value="<?php echo @$pers_physicality['phy_skin_detail']; ?>" /></div>
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" style="padding-left: 60px;"><div class="text"><label>3. ตำหนิ (ไฝ, ปาน, แผลเป็น, รอยสัก)</label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" placeholder="ระบุ" onkeyup="numberandth(this)" name="pers_physicality[phy_mark_detail]" value="<?php echo @$pers_physicality['phy_mark_detail']; ?>" /></div>
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" style="padding-left: 60px;"><div class="text"><label>4. การพูดจาโต้ตอบ</label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" placeholder="ระบุ" onkeyup="numberandth(this)" name="pers_physicality[phy_interaction_detail]" value="<?php echo @$pers_physicality['phy_interaction_detail']; ?>" /></div>
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" style="padding-left: 60px;"><div class="text"><label>5. ท่าทาง</label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" placeholder="ระบุ" onkeyup="numberandth(this)" name="pers_physicality[phy_expression_detail]" value="<?php echo @$pers_physicality['phy_expression_detail']; ?>" /></div>
                                                                                        <input type="hidden" id="pers_id" name="pers_physicality[pers_id]" value="<?php echo @$adm_info['pers_id']; ?>">
                                                                                  </div><!--end form-group row-->
                                                                            </div> <!--end col-xs-12 col-sm-6-->
                                                                            
                                                                       </div><!--form-group row-->
                                                                </div><!-- close panel-body-->

                                                                <div class="panel-body" style="border:1; padding: 20px; padding-bottom: 0px;">
                                                                       <div class="form-group row" style="margin-bottom: 10px;">
                                                                            <div class="col-xs-12 col-sm-12">
                                                                                  <div class="form-group row"><!-- row leverl 2-->
                                                                                      <div class="col-xs-12 col-sm-12"><b><u>ลักษณะความพิการ (ถ้ามี)</u></b></div>
                                                                                      <?php $tmp_dis = $this->common_model->custom_query("SELECT * FROM std_disability ORDER BY dis_code ASC");
                                                                                      foreach ($tmp_dis as $key => $value) { ?>
                                                                                        <div class="col-xs-12 col-sm-12"><br></div>
                                                                                        <div class="col-xs-12 col-sm-3" ><div class="i-checks" style="padding-left: 40px;"><label><input type="checkbox" name="pers_disability[dis_code][<?php echo $value['dis_code'] ?>]" value="<?php echo $value['dis_code'] ?>"  <?php if(@$pers_disability[$value['dis_code']]['dis_code'] == $value['dis_code']){ echo 'checked';} ?>>  <?php echo $value['dis_title']; ?></label></div></div>
                                                                                        <div class="col-xs-12 col-sm-9" ><input type="text" class="form-control" onkeyup="nonthnumandsym(this)" placeholder="ระบุ" id="dis-<?php echo $value['dis_code']; ?>" name="pers_disability[dis_remark][<?php echo $value['dis_code']; ?>]" value="<?php echo @$pers_disability[$value['dis_code']]['dis_remark']; ?>" <?php if(!isset($pers_disability[$value['dis_code']]['dis_remark'])) { echo "disabled";} ?>></div>


                                                                                      <?php } ?>
                                                                                  </div><!--end form-group row-->
                                                                            </div> <!--end col-xs-12 col-sm-6-->
                                                                            
                                                                       </div><!--form-group row-->
                                                                </div><!-- close panel-body-->
                                                              </div><!-- close panel-default-->
                                                      </div><!-- close panel group ข้อมูลกายภาพ -->
                                                    </div><!-- close  form-group row ข้อมูลกายภาพ -->
                                                    <div class="form-group row" style="margin-top: 5px">
                                                      <!-- panel group ข้อมูลกายภาพ -->
                                                      <div class="panel-group" style="margin-bottom: 0px;">
                                                            <div class="panel panel-default" style="border:0">
                                                                <div class="panel-heading"><h4>ข้อมูลด้านสุขภาพ</h4></div>

                                                                <div class="panel-body" style="border:1;padding: 20px; padding-bottom: 0px;">
                                                                       <div class="form-group row" style="margin-bottom: 10px;">
                                                                            <div class="col-xs-12 col-sm-12" > 
                                                                                  <div class="form-group row"><!-- row leverl 2-->
                                                                                      <div class="col-xs-12 col-sm-12"><b><u>ประวัติสุขภาพ </u></b></div>
                                                                                        
                                                                                          <div class="col-xs-12 col-sm-12"><br></div>
                                                                                              <div class="col-xs-12 col-sm-3">
                                                                                                <label class="col-2 col-form-label" style="padding-left: 60px;" >ส่วนสูง (เซนติเมตร)</label>
                                                                                              </div>
                                                                                              <div class="col-xs-12 col-sm-2">
                                                                                                <input title="ส่วนสูง"  class="form-control" type="text" onkeyup="numberndot(this)" name="pers_health_record[pers_height]" value="<?php echo @$pers_health_record['pers_height']; ?>" />
                                                                                              </div>
                                                                                              <div class="col-xs-12 col-sm-2">
                                                                                                <label class="col-2 col-form-label" >น้ำหนัก (กิโลกรัม)</label>
                                                                                            </div>
                                                                                              <div class="col-xs-12 col-sm-2">
                                                                                                <input title="น้ำหนัก" class="form-control" type="text" onkeyup="numberndot(this)" name="pers_health_record[pers_weight]" value="<?php echo @$pers_health_record['pers_weight']; ?>"/>
                                                                                              </div>
                                                                                          </div><!--end น้ำหนัก -->
                                                                                     

                                                                                          <div class="col-xs-12 col-sm-12"><br></div>
                                                                                          <div class="form-group row">
                                                                                                      <div class="col-xs-12 col-sm-3"><label class="col-2 col-form-label" style="padding-left: 60px;"> สภาพร่างกาย </label></div>
                                                                                                      <div class="col-xs-12 col-sm-9" style="padding: 3px 15px" ><textarea title="สภาพร่างกาย" rowspan="2" name="pers_health_record[pers_physical_condition]" class="form-control" ><?php echo @$pers_health_record['pers_physical_condition']; ?></textarea></div>
                                                                                          </div><!-- end row-->
                                                                                          <div class="form-group row">
                                                                                                      <div class="col-xs-12 col-sm-3"><label class="col-2 col-form-label" style="padding-left: 60px;"> สภาพจิตใจ </label></div>
                                                                                                      <div class="col-xs-12 col-sm-9" style="padding: 3px 15px" ><textarea title="สภาพจิตใจ" name="pers_health_record[pers_mental_condition]" class="form-control"><?php echo @$pers_health_record['pers_mental_condition']; ?></textarea></div>
                                                                                          </div><!-- end row-->
                                                                                          <div class="form-group row">
                                                                                                      <div class="col-xs-12 col-sm-3"><label class="col-2 col-form-label" style="padding-left: 60px;"> โรคประจำตัว </label></div>
                                                                                                      <div class="col-xs-12 col-sm-9"style="padding: 3px 15px" ><textarea title="โรคประจำตัว" name="pers_health_record[pers_congenital_disease]" class="form-control"><?php echo @$pers_health_record['pers_congenital_disease']; ?></textarea></div>
                                                                                          </div><!-- end row-->
                                                                                          <div class="form-group row">
                                                                                                      <div class="col-xs-12 col-sm-3"><label class="col-2 col-form-label" style="padding-left: 60px;"> ประวัติการแพ้ยา </label></div>
                                                                                                      <div class="col-xs-12 col-sm-9"style="padding: 3px 15px" ><textarea title="ประวัติการแพ้ยา" name="pers_health_record[pers_drug_allergy]" class="form-control"><?php echo @$pers_health_record['pers_drug_allergy']; ?></textarea></div>
                                                                                          </div><!-- end row-->
                                                                                          <input type="hidden" id="pers_id" name="pers_health_record[pers_id]" value="<?php echo @$adm_info['pers_id']; ?>">

                                                                                      
                                                                                        
                                                                                        
                                
                                                                                        </div>
                                                                                        
                                                                                        
                                                                                  </div><!--end form-group row-->
                                                                                   
                                                                                  </div><!--end form group row-->
                                                                            </div> <!--end col-xs-12 col-sm-6-->
                                                                            
                                                                       </div><!--form-group row-->
                                                                </div><!-- close panel-body-->

                                                              
                                                              </div><!-- close panel-default-->
                                                      </div><!-- close panel group ข้อมูลกายภาพ -->
                                                    </div><!-- close  form-group row ข้อมูลกายภาพ -->

               



                                              </div>
                                          </div>
                                      </div>

                                    <?php
                                    echo form_close();
                                    ?>

                                    </div>

                                      <hr style="margin-top: 0px;">
                                        <div class="row">
                                         <div class="col-xs-12 col-sm-8">&nbsp;</div>
                                         <div class="col-xs-12 col-sm-2">
                                          <button style="height: 40px;width: 100% !important;" type="button" class="btn btn-primary btn-md btn-save"><i class="fa fa-floppy-o" aria-hidden="true"></i> บันทึก</button>
                                        </div>
                                        <div class="col-xs-12 col-sm-2">
                                          <button style="height: 40px;width: 100% !important;" type="button" class="btn btn-primary btn-md btn-cancel" onclick="window.location.href='<?php echo site_url('welfare/welfare_list');?>'"><i class="fa fa-undo" aria-hidden="true"></i> ย้อนกลับ</button>
                                        </div>
                                      </div><!-- close class row-->


                                </div>
                            </div>

                            <div id="tab-2" <?php if($usrpm['app_id']==4){?>class="tab-pane active" <?php }else{?> class="tab-pane"<?php }?>>
                                <div class="panel-body">
                                    <!--<strong>Tab-3</strong>-->
                                </div>
                            </div>

                            <div id="tab-3" <?php if($usrpm['app_id']==5){?>class="tab-pane active" <?php }else{?> class="tab-pane"<?php }?>>
                                <div class="panel-body">
                                    <!-- <strong>Tab-3</strong> -->
                                </div>
                            </div>

                        </div><!-- close tab-content-->


                    </div>
                </div>
                </div>



<script type="text/javascript">
<?php if($process_action == 'Edited'){ ?>
    setTimeout(function(){$("#Province").val('<?php echo @$addr_info['province_code']; ?>').trigger('change');},200);
    setTimeout(function(){$("#fml_province").val('<?php echo @$addr_info['province_code']; ?>').trigger('change');},200);
    <?php } ?>
    function set_enable(elem,target='') {
    if(elem.prop('checked') == true) {
      $(target).prop('disabled', false ).focus();
    }else{
      $(target).val('');
      $(target).prop('disabled', true );
    }
  }
  function optionGen(code,target,opSelect) {
    //alert('code='+code.value);
     //alert('op='+opSelect);
     //alert('POST')
    $.ajax({
      url: base_url+'personals/get_Area_option',
      type: 'POST',
      dataType: 'json',
      data: {
        'code': code.value,
        'type': target,
        <?php echo $csrf['name'];?>: '<?php echo $csrf['hash'];?>'
      },
    })
    .done(function(ret) {
      console.log("success");
     // console.dir('off',ret);
      $('#'+target).empty();
      if($("input[name='elder_addr_chk']").prop('checked') == true){
        $('#'+target).prop('disabled', true);
      }else{
        $('#'+target).prop('disabled', false);
      }
      if(target == 'Amphur'){
        str = "เลือกอำเภอ";
      }else if(target == 'Tambon'){
        str = "เลือกตำบล";
      }
      $('#'+target).append($('<option>', {
        value: '',
        text : str
      }));
      for (var i = 0; i < ret.length ; i++) {
        // if(ret[i].area_code == opSelect){
          $('#'+target).append($('<option>', {
            value: ret[i].area_code,
            text : ret[i].area_name_th
          }));
  
      }
      $('#'+target).val(opSelect).trigger('change');
    })
    .fail(function() {
      console.log("error");
    });
  }

    function optionGen2(code,target,opSelect) {
    //  alert('code='+code.value+' op='+opSelect+' target='+target);

    $.ajax({
      url: base_url+'personals/get_Area_option2',
      type: 'POST',
      dataType: 'json',
      data: {
        'code': code.value,
        'type': target,
        <?php echo $csrf['name'];?>: '<?php echo $csrf['hash'];?>'
      },
    })
    .done(function(ret) {
      console.log("success");
     // console.dir('off',ret);
      $('#'+target).empty();
      // if($("input[name='elder_addr_chk']").prop('checked') == true){
      //   $('#'+target).prop('disabled', true);
      // }else{
      //   $('#'+target).prop('disabled', false);
      // }
      if(target == 'fml_amphur'){
        str = "เลือกอำเภอ";
      }else if(target == 'fml_tambon'){
        str = "เลือกตำบล";
      }
      $('#'+target).append($('<option>', {
        value: '',
        text : str
      }));
      for (var i = 0; i < ret.length ; i++) {
        // if(ret[i].area_code == opSelect){
          $('#'+target).append($('<option>', {
            value: ret[i].area_code,
            text : ret[i].area_name_th
          }));
  
      }
      $('#'+target).val(opSelect).trigger('change');
    })
    .fail(function() {
      console.log("error");
    });
  }
</script>



<!-- Modal -->
  <div class="modal fade" id="modal_marker" role="dialog">
    <div class="modal-dialog modal-lg">

      <!-- Modal content-->
      <div class="modal-content" style="font-size:14px;">
        <div class="modal-header" style="background-color: rgb(56,145,209);color: white;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <b><i class="fa fa-map-marker" aria-hidden="true"></i> ค้นหาสถานที่</b>
        </div>
        <div class="modal-body">

      <form name="form_search" method="post" action="">

      ชื่อสถานที่
        <div class="row">
          <div class="col-xs-12 col-sm-10">
              <input name="namePlace" class="form-control" size="70" type="text" id="namePlace" size="30" />
              <input type="hidden" name="address" id="namePlace2">
          </div>
          <div class="col-xs-12 col-sm-2">
                        <a href="#" class="btn btn-default btn-search" style="width: 100%; margin-top: 0px; color:#fff" name="SearchPlace" id="SearchPlace" value="ค้นหา" ><i style='font-size:14px;' class="fa fa-search" aria-hidden="true"></i> ค้นหา
                        </a>
            </div>
        </div>
       </form>

      <hr />

      <form id="form_get_detailMap" name="form_get_detailMap" method="post" action="">
        <div class="row">
          <div class="col-xs-6 col-sm-5">
            ละติจูด <input class="form-control" name="lat_value" type="text" id="lat_value" value="0" size="20" readonly />
          </div>
          <div class="col-xs-6 col-sm-5">
            ลองจิจูด <input class="form-control" name="lon_value" type="text" id="lon_value" value="0" size="20" readonly />
          </div>
          <div class="col-xs-12 col-sm-2">
                        <a href="#" class="btn btn-default btn-save" style="margin-top: 22px; width: 100%; color:#fff" name="button" id="button" onclick="select_location();" value="บันทึก" ><i style='font-size:14px;' class="fa fa-floppy-o" aria-hidden="true"></i> บันทึก
                        </a>
            </div>
          </div>
      </form>

      <div class="row">
        <div class="col-xs-12 col-sm-12">
          <!-- show map -->
          <div id="map_canvas" style="width:100%;height:400px;margin:auto;margin-top:10px;"></div>
        </div>
      </div>

        </div>
        <!--
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        -->
      </div>

    </div>
  </div>
  <!-- END modal_marker -->

  <!-- Delete Modal -->
  <div id="disStatusModel" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="color: #333; font-size: 20px;">หน้าต่างแจ้งเตือนเพื่อยืนยัน</h4>
        </div>
        <div class="modal-body">
          <?php $str = getMsg('034');?>
          <p id="disStatusStr"></p>
          <p>ต้องการแก้ไขข้อมูลหรือไม่</p>
        </div>
        <div class="modal-footer">
          <button id="disStatusYes" type="button" class="btn btn-danger">ตกลง</button>
          <button id="disStatusNo" type="button" style="margin-bottom: 5px;" class="btn btn-default" >ยกเลิก</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End Delete Model -->

<!-- Delete Modal -->
<div id="dltModel" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color: #333; font-size: 20px;">หน้าต่างแจ้งเตือนเพื่อยืนยัน</h4>
      </div>
      <div class="modal-body">
        <?php $str = getMsg('034');?>
        <p><?php echo $str;?></p>
        <!--<p>ยืนยันการลบ?</p>-->
      </div>
      <div class="modal-footer">
        <button id="dltbtnYes" type="button" class="btn btn-danger">ตกลง</button>
        <button type="button" style="margin-bottom: 5px;"  aria-hidden="true" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
      </div>
    </div>
  </div>
</div>
<!-- End Delete Model -->

<!-- Confirm Save Form  Modal -->
<div id="sbmCnfrm" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color: #333; font-size: 20px;">หน้าต่างแจ้งเตือนเพื่อยืนยัน</h4>
      </div>
      <div class="modal-body">
        <?php $str = getMsg('054');?>
        <p><?php echo $str;?></p>
        <!--<p>ยืนยันการลบ?</p>-->
      </div>
      <div class="modal-footer">
        <button id="savbtnYes" type="button" class="btn btn-success" data-dismiss="modal">ตกลง</button>
        <button type="button" style="margin-bottom: 5px;" aria-hidden="true" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
      </div>
    </div>
  </div>
</div>
<!-- End Confirm Save Form  Modal -->

<!-- Confirm Back Modal -->
<div id="bckCnfrm" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color: #333; font-size: 20px;">หน้าต่างแจ้งเตือนเพื่อยืนยัน</h4>
      </div>
      <div class="modal-body">
        <?php $str = getMsg('061');?>
        <p><?php echo $str;?></p>
        <!--<p>ยืนยันการลบ?</p>-->
      </div>
      <div class="modal-footer">
        <button id="bckbtnYes" type="button" class="btn btn-warning">ตกลง</button>
        <button type="button" style="margin-bottom: 5px;" aria-hidden="true" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
      </div>
    </div>
  </div>
</div>
<!-- End Confirm Back Modal -->

<!-- Print Modal -->
<div id="myPrint"  class="modal fade" role="dialog">
  <div class="modal-dialog">

     <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
         <h4 class="modal-title" style="color: #333; font-size: 20px;">พิมพ์แบบฟอร์ม</h4>
       </div>
      <div class="modal-body">
        <div class="row">
          <?php
          $tmp = $this->admin_model->getOnce_Application(17);
          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(17,get_session('user_id')); //Check User Permission
          ?>
          <div class="col-xs-12 col-sm-12" style="margin-bottom: 10px;"
          <?php
          if(!isset($tmp1['perm_status'])) { ?>
              class="disabled"
          <?php
            }else if($usrpm['app_id']==7) {
          ?>
              class="active"
          <?php
            }
          ?>
           >
            <a style="color: #333; font-size: 20px;" target="_blank" href="<?php echo site_url('report/A1');?>"><i class="fa fa-print" aria-hidden="true"></i> <?php if(isset($tmp1['perm_status'])) {echo $tmp1['app_name']; }?>
            </a>
          </div>

          <!--
          <?php
          $tmp = $this->admin_model->getOnce_Application(8);
          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(8,get_session('user_id')); //Check User Permission
          ?>
          <div class="col-xs-12 col-sm-12" style="margin-bottom: 10px;"
          <?php
          if(!isset($tmp1['perm_status'])) { ?>
              class="disabled"
          <?php
            }else if($usrpm['app_id']==8) {
          ?>
              class="active"
          <?php
            }
          ?>
           >
            <a style="color: #333; font-size: 20px; margin-bottom: 50px;" target="_blank" href="<?php echo site_url('report/A2');?>"><i class="fa fa-print" aria-hidden="true"></i> <?php if(isset($tmp1['perm_status'])) {echo $tmp1['app_name']; }?>
            </a>
          </div>

          <?php
          $tmp = $this->admin_model->getOnce_Application(9);
          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(9,get_session('user_id')); //Check User Permission
          ?>
          <div class="col-xs-12 col-sm-12" style="margin-bottom: 10px;"
          <?php
          if(!isset($tmp1['perm_status'])) { ?>
              class="disabled"
          <?php
            }else if($usrpm['app_id']==9) {
          ?>
              class="active"
          <?php
            }
          ?>
           >
            <a style="color: #333; font-size: 20px; margin-bottom: 50px;" target="_blank" href="<?php echo site_url('report/A3');?>"><i class="fa fa-print" aria-hidden="true"></i> <?php if(isset($tmp1['perm_status'])) {echo $tmp1['app_name']; }?>
            </a>
          </div>

          <?php
          $tmp = $this->admin_model->getOnce_Application(10);
          $tmp1 = $this->admin_model->chkOnce_usrmPermiss(10,get_session('user_id')); //Check User Permission
          ?>
          <div class="col-xs-12 col-sm-12" style="margin-bottom: 10px;"
          <?php
          if(!isset($tmp1['perm_status'])) { ?>
              class="disabled"
          <?php
            }else if($usrpm['app_id']==10) {
          ?>
              class="active"
          <?php
            }
          ?>
           >
            <a style="color: #333; font-size: 20px; margin-bottom: 50px;" target="_blank" href="<?php echo site_url('report/A4');?>"><i class="fa fa-print" aria-hidden="true"></i> <?php if(isset($tmp1['perm_status'])) {echo $tmp1['app_name']; }?>
            </a>
          </div>
           -->

         </div>
         <br/>

      </div>
    </div>

  </div>
 </div>
 <!-- End Print Modal -->

<script>

setTimeout(function(){
  integration0(<?php echo get_session('user_id');?>);
  $("#integration0_toggle").click();
},300);

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
Object.size = function(obj) {
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
};

var integration0 = function(pid) {
    $.ajax({
    url: '<?php echo site_url('welfare/getReqHistory')?>',
    type: 'POST',
    dataType: 'json',
    data: {
        'user_id': pid,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(Object.size(value)>0) {
            $("#integration0 table tbody").html("");
            $("#row0_history").html("<span style='color:#D25200'>"+Object.size(value)+"</span> รายการ");

            $(value).each(function(key,data) {
                $("#integration0 table tbody").append("<tr style='text-align:center'><td>"+data.num+"</td><td>"+data.name+"</td><td>"+data.req_org+"</td><td>"+data.date_of_adm+"</td><td>"+data.date_of_dis+"</td></tr>");
            });
          }
          $("#integration0").show();//Show Dialog
        }else { //Result no Data
          $("#integration0").show();//Show Dialog
        }
      },
      error:function() { //Result Error
        //toastr.error("ดึงข้อมูลประวัติการดูแลผู้สูงอายุล้มเหลว","หน้าต่างแจ้งเตือน");
      },
    });
  //$("<tr><td colspan='5'>ไม่พบข้อมูล..</td></tr>").html($("#integration0 table tbody"));
}

var integration1 = function(info) {
  $("#integration1").show();//Show Dialog

  //Service 1
  if(info.age>=60) {
    info.date_of_birth = info.date_of_birth==''?'-':info.date_of_birth;
    $("#row1_date_of_birth").html("<span style='color:green'>"+info.date_of_birth+"</span>");
    $("#row1_state").html("<i class='fa fa-check text-navy'></i>");
    $("#age_status_txt").html("60 ปีขึ้นไป");
  }else {
    info.date_of_birth = info.date_of_birth==''?'-':info.date_of_birth;
    $("#row1_date_of_birth").html("<span style='color:red'>"+info.date_of_birth+"</span>");
    $("#row1_state").html("<i class='fa fa-times text-danger'></i>");
    $("#age_status_txt").html("ต่ำกว่า 60 ปี");
  }
  //$("#pers_old").html(info.age); 
  //End Service 1

  //Service 2
  if(info.date_of_death!='') {
    info.date_of_death = info.date_of_death==''?'-':info.date_of_death;
    $("#row2_date_of_death").html("<span style='color:red'>"+info.date_of_death+"</span>");
    $("#row2_state").html("<i class='fa fa-times text-danger'></i>");

    $("#death_status_txt").html("เสียชีวิต");
  }else {
    info.date_of_death = info.date_of_death==''?'-':info.date_of_death;
    $("#row2_date_of_death").html("<span style='color:green'>"+info.date_of_death+"</span>");
    $("#row2_state").html("<i class='fa fa-check text-navy'></i>");

    $("#death_status_txt").html("มีชีวิตอยู่");
  }
  //End Service 2
  info.reg_addr.addr_home_no = info.reg_addr.addr_home_no==null?'-':info.reg_addr.addr_home_no;
  info.reg_addr.addr_sub_district = info.reg_addr.addr_sub_district==null?'-':info.reg_addr.addr_sub_district;
  //Service 3
    // $.ajax({
    // url: 'https://gateway.dop.go.th/transfer/import/RequestElderyJPTH',
    // type: 'POST',
    // dataType: 'json',
    // data: {
    //     'Username': 'dopjpth',
    //     'Password': 'dpuser',
    //     'OfficerPID': pers_authen.pid,
    //     'addr_home_no': info.reg_addr.addr_home_no,
    //     'addr_sub_district': info.reg_addr.addr_sub_district,
    //     'csrf_dop': csrf_hash
    // },
    //   success: function (value) { //Result True
    //     //console.log("success");console.dir(value);
    //     if(Object.keys(value).length) {
    //       console.log(value);
    //       if(value[0].message!='') {
    //         toastr.warning("ไม่พบข้อมูลความจำเป็นพื้นฐาน (จปฐ.)","หน้าต่างแจ้งเตือน");
    //         $("#accountJPTH").html("ไม่พบข้อมูล.");
    //         $("#row3_state").html("<i class='fa fa-exclamation-triangle text-warning'></i>");
    //       }else {
    //         //toastr.success("ดึงข้อมูลความจำเป็นพื้นฐาน (จปฐ.)เสร็จสิ้น","หน้าต่างแจ้งเตือน");
    //         $("#accountJPTH").html("");
    //         $("<option value=''>ไม่พบข้อมูล.</option>").appendTo($("#accountJPTH"));
    //         $("#accountJPTH").attr("size",Object.size(value));
    //         $(value).each(function(key,data) {
    //           console.log(data);
    //           $("<option value="+data.Q23AvgIncome+">อาชีพ (ปัจจุบัน) : "+data.Career+" รายได้เฉลี่ย "+numberWithCommas(data.Q23AvgIncome)+" (บาท/เดือน) :  ที่มาของรายได้ : - *("+data.MemberName+" "+data.MemberLastName+") บ้านเลขที่"+data.HHNumber+" หมู่บ้าน "+data.VillName+" ซอย "+data.Soi+" ถนน "+data.Tanon+"</option>").appendTo($("#accountJPTH"));
    //         });
    //       }
    //     }else { //Result no Data
    //       toastr.warning("ไม่พบข้อมูลความจำเป็นพื้นฐาน (จปฐ.)","หน้าต่างแจ้งเตือน");
    //       $("#accountJPTH").html("");
    //       $("<option value=''>ไม่พบข้อมูล.</option>").appendTo($("#accountJPTH"));
    //       $("#row3_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
    //     }
    //   },
    //   error:function() { //Result Error
    //     toastr.error("ดึงข้อมูลความจำเป็นพื้นฐาน (จปฐ.)ล้มเหลว","หน้าต่างแจ้งเตือน");
    //     $("#accountJPTH").html("");
    //     $("<option value=''>ไม่พบข้อมูล.</option>").appendTo($("#accountJPTH"));
    //     $("#row3_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
    //   },
    // });
    // $("#accountJPTH").change(function() {
    //   console.log();
    //   if($(this).val()>38000) {
    //     $("#income_state").html("เกิน 38,000");
    //   }else {
    //     $("#income_state").html("ไม่เกิน 38,000");
    //   }
    // });
  //End Service 3

  //Service 4
    $.ajax({
    url: 'https://gateway.dop.go.th/transfer/import/RequestOlderEmploymentRegistration',
    type: 'POST',
    dataType: 'json',
    data: {
        'eldery_pid': info.pid,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(value[0].message!='') {
            toastr.warning("ไม่พบข้อมูลทะเบียนจัดหางานผุ้สูงอายุ","หน้าต่างแจ้งเตือน");
            $("#row4_date_of_reg_th").html("<span>-</span>");
            $("#row4_reg_status").html("<span>-</span>");
            $("#row4_state").html("<i class='fa fa-exclamation-triangle text-warning'></i>");
          }else {
            //toastr.success("ดึงข้อมูลทะเบียนจัดหางานผุ้สูงอายุเสร็จสิ้น","หน้าต่างแจ้งเตือน");
            if(value[0].date_of_reg!='') {
              $("#row4_date_of_reg_th").html("<span style='color:green'>"+value[0].date_of_reg_th+"</span>");
            }
            if(value[0].reg_status=="ยังไม่ได้งาน") {
              $("#row4_reg_status").html("<span style='color:#D25200'>"+value[0].reg_status+"</span>");
            }else {
              $("#row4_reg_status").html("<span style='color:green'>"+value[0].reg_status+"</span>");
            }
            $("#row4_state").html("<i class='fa fa-check text-navy'></i>");
          }
        }else { //Result no Data
          toastr.warning("ไม่พบข้อมูลทะเบียนจัดหางานผุ้สูงอายุ","หน้าต่างแจ้งเตือน");
          $("#row4_date_of_reg_th").html("<span>-</span>");
          $("#row4_reg_status").html("<span>-</span>");
          $("#row4_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
        }
      },
      error:function() { //Result Error
        toastr.error("ดึงข้อมูลทะเบียนจัดหางานผุ้สูงอายุล้มเหลว","หน้าต่างแจ้งเตือน");
        $("#row4_date_of_reg_th").html("<span>-</span>");
        $("#row4_reg_status").html("<span>-</span>");
        $("#row4_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
      },
    });
  //End Service 4

  //Service 5
    $.ajax({
    url: 'https://gateway.dop.go.th/transfer/import/RequestElderyFoundation',
    type: 'POST',
    dataType: 'json',
    data: {
        'Username': 'dopuser',
        'Password': 'dpuser',
        'OfficerPID': pers_authen.pid,
        'TargetPID': info.pid,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(value.message!='') {
            toastr.warning("ไม่พบข้อมูลประวัติการกู้ยืมกองทุน","หน้าต่างแจ้งเตือน");
            $("#row5_loan_history").html("<span>-</span>");
            $("#row5_contract_status").html("<span>-</span>");
            $("#row5_state").html("ไม่พบข้อมูลประวัติการกู้ยืมกองทุน");
          }else {
            //toastr.success("ดึงข้อมูลประวัติการกู้ยืมกองทุนเสร็จสิ้น","หน้าต่างแจ้งเตือน");
            if(value.loan_history=='มีประวัติ') {
              $("#row5_loan_history").html("<span style='color:green'>"+value.loan_history+"</span>");
            }else {
              $("#row5_loan_history").html("<span style='color:#D25200'>"+value.loan_history+"</span>");
            }
            if(value.contract_status=="ปิดสัญญาแล้ว") {
              $("#row5_contract_status").html("<span style='color:#D25200'>"+value.contract_status+"</span>");
            }else {
              $("#row5_contract_status").html("<span style='color:green'>"+value.contract_status+"</span>");
            }
            $("#row5_state").html("ดึงข้อมูลประวัติการกู้ยืมกองทุนเสร็จสิ้น");
          }
        }else { //Result no Data
          toastr.warning("ไม่พบข้อมูลประวัติการกู้ยืมกองทุน","หน้าต่างแจ้งเตือน");
          $("#row5_loan_history").html("<span>-</span>");
          $("#row5_contract_status").html("<span>-</span>");
          $("#row5_state").html("ไม่พบข้อมูลประวัติการกู้ยืมกองทุน");
        }
      },
      error:function() { //Result Error
        toastr.error("ดึงข้อมูลประวัติการกู้ยืมกองทุนล้มเหลว","หน้าต่างแจ้งเตือน");
        $("#row5_loan_history").html("<span>-</span>");
        $("#row5_contract_status").html("<span>-</span>");
        $("#row5_state").html("ดึงข้อมูลประวัติการกู้ยืมกองทุนล้มเหลว");
      },
    });
  //End Service 5

  /*
  //Service 6
    $.ajax({
    url: base_url+'difficult/getHistory',
    type: 'POST',
    dataType: 'json',
    data: {
        'pers_id': info.pers_id,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(value.message!='') {
            toastr.warning("ไม่พบข้อมูลการสงเคราะห์ผู้สูงอายุในภาวะยากลำบาก","หน้าต่างแจ้งเตือน");
            $("#row6_history").html("<span>-</span>");
            $("#row6_year_now_history").html("<span>-</span>");
            $("#row6_state").html("<i class='fa fa-exclamation-triangle text-warning'></i>");
          }else {
            //toastr.success("ตรวจสอบข้อมูลการสงเคราะห์ผู้สูงอายุในภาวะยากลำบากเสร็จสิ้น","หน้าต่างแจ้งเตือน");
            if(value.history=='มีประวัติ') {
              $("#row6_history").html("<span style='color:#D25200'>"+value.history+"</span>");
            }else {
              $("#row6_history").html("<span style='color:green'>"+value.history+"</span>");
            }
            if(value.year_now_history>0) {
              $("#row6_year_now_history").html("<span style='color:red'>"+value.year_now_history+"</span>");
            }else {
              $("#row6_year_now_history").html("<span style='color:green'>"+value.year_now_history+"</span>");
            }
            $("#row6_state").html("<i class='fa fa-check text-navy'></i>");
          }
        }else { //Result no Data
          toastr.warning("ไม่พบข้อมูลการสงเคราะห์ผู้สูงอายุในภาวะยากลำบาก","หน้าต่างแจ้งเตือน");
          $("#row6_history").html("<span>-</span>");
          $("#row6_year_now_history").html("<span>-</span>");
          $("#row6_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
        }
      },
      error:function() { //Result Error
        toastr.error("ตรวจสอบข้อมูลการสงเคราะห์ผู้สูงอายุในภาวะยากลำบากล้มเหลว","หน้าต่างแจ้งเตือน");
        $("#row6_history").html("<span>-</span>");
        $("#row6_year_now_history").html("<span>-</span>");
        $("#row6_state").html("<i class='fa fa-exclamation-triangle text-danger'></i>");
      },
    });
  //End Service 6
  */

  //Service 7
    $.ajax({
    url: base_url+'welfare/getHistory',
    type: 'POST',
    dataType: 'json',
    data: {
        'pers_id': info.pers_id,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(value.message!='') {
            toastr.warning("ไม่พบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯ","หน้าต่างแจ้งเตือน");
            $("#row7_history").html("<span>-</span>");
            $("#row7_year_now_history").html("<span>-</span>");
            $("#row7_req_org").html("<span>-</span>");
            $("#row7_state").html("ไม่พบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯ");
          }else {
            //toastr.success("ตรวจสอบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯเสร็จสิ้น","หน้าต่างแจ้งเตือน");
            if(value.history=='มีประวัติ') {
              $("#row7_history").html("<span style='color:#D25200'>"+value.history+"</span>");
            }else {
              $("#row7_history").html("<span style='color:green'>"+value.history+"</span>");
            }
            if(value.year_now_history>0) {
              $("#row7_year_now_history").html("<span style='color:red'>"+value.year_now_history+"</span>");
            }else {
              $("#row7_year_now_history").html("<span style='color:green'>"+value.year_now_history+"</span>");
            }

            value.req_org = value.req_org==null?'-':value.req_org;
            $("#row7_req_org").html("<span>"+value.req_org+"</span>");
            $("#row7_state").html("ตรวจสอบข้อมูลเสร็จสิ้น");
          }
        }else { //Result no Data
          toastr.warning("ไม่พบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯ","หน้าต่างแจ้งเตือน");
          $("#row7_history").html("<span>-</span>");
          $("#row7_year_now_history").html("<span>-</span>");
          $("#row7_req_org").html("<span>-</span>");
          $("#row7_state").html("ไม่พบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯ");
        }
      },
      error:function() { //Result Error
        toastr.error("ตรวจสอบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯล้มเหลว","หน้าต่างแจ้งเตือน");
        $("#row7_history").html("<span>-</span>");
        $("#row7_year_now_history").html("<span>-</span>");
        $("#row7_req_org").html("<span>-</span>");
        $("#row7_state").html("ตรวจสอบข้อมูลการรับบริการศูนย์พัฒนาการจัดสวัสดิการสังคมฯล้มเหลว");
      },
    });
  //End Service 7

   //ลองจปฐ
   $.ajax({
    url: base_url+'welfare/getElderyJPTH',
    type: 'POST',
    dataType: 'json',
    data: {
        'pers_id': info.pid,
        'csrf_dop': csrf_hash
    },
      success: function (value) { //Result True
      //console.log('HI',value)
        //console.log("success");console.dir(value);
        if(Object.keys(value).length) {
          console.log(value);
          if(value.message!='') {
            toastr.warning("ไม่พบข้อมูลความจำเป็นพื้นฐาน (จปฐ.)","หน้าต่างแจ้งเตือน");       
            $("#jpth_detail").html("ไม่พบข้อมูลความจำเป็นพื้นฐาน (จปฐ.)");
          }else {
            //toastr.success("ตรวจสอบข้อมูลการสงเคราะห์ผู้สูงอายุในภาวะยากลำบากเสร็จสิ้น","หน้าต่างแจ้งเตือน");
            if(value.history =='มีประวัติ'){
                  if(value.income>38000) {
                    $("#income_state").html("เกิน 38,000");
                    $("#jpth_detail").html(numberWithCommas(value.income)+" (บาท/ปี)");
                  }else {
                    $("#income_state").html("ไม่เกิน 38,000");
                    $("#jpth_detail").html(numberWithCommas(value.income)+" (บาท/ปี)");
                   // $("#jpth_detail").html("<span>รายได้เฉลี่ย: "+numberWithCommas(value.income)+" อาชีพ: "+value.occupation+"</span>");
                  }
            
            }
            else{
              $("#jpth_detail").html("<span>ไม่พบข้อมูล</span>");
              $("#income_state").html("ไม่พบข้อมูล");

            }
            
          }
        }else { //Result no Data
          toastr.warning("ไม่พบข้อมูลความจำเป็นพื้นฐาน (จปฐ.)","หน้าต่างแจ้งเตือน");
          $("#jpth_detail").html("<span>ไม่พบข้อมูล</span>");
        }
      },
      error:function() { //Result Error
        toastr.error("ดึงข้อมูลความจำเป็นพื้นฐาน (จปฐ.)ล้มเหลว","หน้าต่างแจ้งเตือน");
        $("#jpth_detail").html("<span>ไม่พบข้อมูล</span>");
       
      },
    });

}
</script>

<script>
$(function(){
  //Check age > 60
  handler_notice_excep_age();
  
});

function notice_excep_age(age){
  if(age < 60){
    $('.alert-excep-age').removeClass('hide');
    $('.btn-save').prop('disabled', true);

  }else{

    $('.alert-excep-age').addClass('hide');
    $('.btn-save').prop('disabled', false);
  }

  if(age == -1){
    $('.alert-excep-age').addClass('hide');
    $('.btn-save').prop('disabled', false);
  }
  
}

function handler_notice_excep_age(){
  if(!$('.alert-excep-age').hasClass('hide')){
    $('.btn-save').prop('disabled', true);
  }
}


function cardInfo(){
    //alert('ddd');
    showloadersc('warning','กรุณารอสักครู่ กำลังโหลดข้อมูล !');
    $.ajax({  
            type: 'GET',
            crossDomain: true,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            // data: param_service,
            url: 'http://localhost:9000/api/Values',
            success: function(data_service) {
              //console.log(data_service)                       
                var data = data_service.personal;                       
                if(data_service.result == false){
                  closeloadswal();
                  toastr.error("บัตรประชาชนต้องเสียบอยู่กับเครื่องอ่านบัตร", "กรุณาตรวจสอบ");
                }else{
                 
                  var varCard = data.Citizenid;
                  var res1 = varCard.substring(0, 1);
                  var res2 = varCard.substring(1, 5);
                  var res3 = varCard.substring(5, 10);
                  var res4 = varCard.substring(10, 12);
                  var res5 = varCard.substring(12, 13);

                
                  var houseNo = data.addrVillageNo.replace("หมู่ที่ ","");
                  $('#req_pid').val(res1+'-'+res2+'-'+res3+'-'+res4+'-'+res5);
                  $('#diff_pid').val(varCard);
                  
                  $('#req_name').html(data.Th_Firstname+' '+data.Th_Lastname);
                  //10 สิงหาคม 2534 (อายุ 29 ปี)
                  var varBirthday = data.Birthday;
                  var bd1 = varBirthday.substring(0, 2);
                  var bd2 = varBirthday.substring(3, 5);
                  var bd3 = varBirthday.substring(6, 10);
                  var varBD = (bd3-543)+'-'+bd2+'-'+bd1;
                  var varBDText = bd3+'-'+bd2+'-'+bd1;

                  $.ajax({
                    type: "POST",
                    url: base_url+"/adaptenvir/getBirthday/",
                    data: {birthday : varBDText,csrf_dop : csrf_hash},
                    success: function(data){

                      $('#req_date_of_birth_text').html(data); 
                      
                    },
                    dataType: "json",
                  });
                
                  //$('#date_of_birth_text').html((bd1-543)+'-'+bd2+'-'+bd3);
                  // $('#gender_name').html(data.Sex);                        

                  if(data.Sex =='0'){
                    $('#req_gender_name').html("ไม่ทราบ");
                  }else if(data.Sex =='1'){
                    $('#req_gender_name').html("ชาย");
                  }else if(data.Sex =='2'){
                    $('#req_gender_name').html("หญิง");
                  }else if(data.Sex =='9'){
                    $('#req_gender_name').html("ไม่สามารถระบุได้");
                  }else{
                    $('#req_gender_name').html("-");
                  }                        
                  $('#req_reg_addr').html(data.Address);
                  $('#req_reg_addr_id').val(data.Address);
                                        
                  $('#pers_firstname_th').val(data.Th_Firstname);
                  $('#pers_lastname_th').val(data.Th_Lastname);
                  $('#gender_code').val(data.Sex);
                  // $('#pid').val(varCard);
                  $('input[name="impv_addr[addr_moo]"]').val(houseNo);
                  $('#date_of_birth').val(varBD);                      
                  $('#addrProvince').attr(data.addrProvince);
                  $('#addrAmphur').attr(data.addrAmphur);
                  $('#addrTambol').attr(data.addrTambol);
                  
                  var province = data.addrProvince.replace("จังหวัด","");
                  var amphur = data.addrAmphur.replace("อำเภอ","");
                  var tambol = data.addrTambol.replace("ตำบล","");

                  $.ajax({
                    type: "POST",
                    url: base_url+"/adaptenvir/getarea/",
                    data: {province_name : province,amphur_name : amphur,tambol_name : tambol,csrf_dop : csrf_hash},
                    success: function(data){
                      // console.log(data)  	
                      closeloadswal();						
                      $('input[name="impv_addr[addr_province]"]').val(data.province_code);		
                      $('input[name="impv_addr[addr_district]"]').val(data.amphur_code);
                      $('input[name="impv_addr[addr_sub_district]"]').val(data.tambol_code);		
                      
                    },
                    dataType: "json",
                  });

                  var houseNo = data.addrVillageNo.replace("หมู่ที่ ","");
                  $('input[name="impv_addr[addr_home_no]"]').val(data.addrHouseNo);
                  $('input[name="impv_addr[addr_moo]"]').val(houseNo);
                  $('input[name="impv_addr[addr_lane]"]').val(data.addrRoad);
                  $('input[name="impv_addr[addr_alley]"]').val('');
                  $('input[name="impv_addr[addr_road]"]').val('');
                }  
            },
            error: function(err) {
              closeloadswal();
              toastr.error("โปรดตรวจสอบข้อมูลเลขบัตรประจำตัวประชาชนผู้สูงอายุ", "หน้าต่างแจ้งเตือน");
              //$('.modal').modal('hide');
              //$('#linkage-loade-'+key).html('<i class="fas fa-download"></i>');
              //  var text = 'กรุณาตรวจสอบ ' + '\n' + '- เครื่องอ่านบัตรต้องเชื่อมต่อ กับ คอมพิวเตอร์ ' + '\n' + '- ต้องมีบัตรประชาชน เสียบอยู่กับเครื่องอ่านบัตร' + '\n' + '- ตรวจสอบว่าโปรแกรม Linkage Service เปิดใช้งานอยู่';
              //  $("#exampleModalLinkage").modal();
                

            }
    });
}


$("input[name='elder_pers_chk']").on('ifChecked', function(event){
  //alert("s");
        $("#elder_pid").val($("#req_pid").val());
    // if(req_pers){
    //     $("#pid").val(req_pers.pid);
        var reqPid =  $("#req_pers_id").val();
        var reqPid2 =  $("#diff_pid").val();
        $("#pers_id").val(reqPid);
        $("#pid_id").val(reqPid2);
        $("#name_sufferer").html($("#pers_firstname_th").val()+' '+$("#pers_lastname_th").val());

       //  $("#date_of_birth_text").html($("#date_of_birth").val());
        var varBirthday = $("#date_of_birth").val();
        var bd1 = varBirthday.substring(0, 4);
        var bd2 = varBirthday.substring(5, 7);
        var bd3 = varBirthday.substring(8, 10);
        $.ajax({
          type: "POST",
          url: base_url+"/adaptenvir/getBirthday/",
          data: {birthday : varBirthday,csrf_dop : csrf_hash},
          success: function(data){

            $('#date_of_birth_sufferer').html(data); 
            
          },
          dataType: "json",
        });
                        
       // $("#gender_name").html($("#gender_code").val());

        if($("#gender_code").val() =='0'){
          $('#gender_name_sufferer').html("ไม่ทราบ");
        }else if($("#gender_code").val() =='1'){
          $('#gender_name_sufferer').html("ชาย");
        }else if($("#gender_code").val() =='2'){
          $('#gender_name_sufferer').html("หญิง");
        }else if($("#gender_code").val() =='9'){
          $('#gender_name_sufferer').html("ไม่สามารถระบุได้");
        }else{
          $('#gender_name_sufferer').html("-");
        }                        
                         // $('#reg_addr').html(data.Address);

    //     $("#nation_name_th").html(req_pers.nation_name_th);
    //     $("#relg_title").html(req_pers.relg_title);
    
        $("#reg_addr_id").val("");
        var reg_addr_id = $('input[name="impv_info[req_reg_addr_id]"]').val();
        $("#reg_addr").html(reg_addr_id);

        var pers_firstname = $('input[name="impv_info[pers_firstname_th]"]').val();
        var pers_lastname = $('input[name="impv_info[pers_lastname_th]"]').val();
        var date_birth = $('input[name="impv_info[date_of_birth]"]').val();
        var gender = $('input[name="impv_info[gender_code]"]').val();

        var addr_home_no = $('input[name="impv_addr[addr_home_no]"]').val();
        var addr_moo = $('input[name="impv_addr[addr_moo]"]').val();
        var addr_province = $('input[name="impv_addr[addr_province]"]').val();
        var addr_district = $('input[name="impv_addr[addr_district]"]').val();
        var addr_sub_district = $('input[name="impv_addr[addr_sub_district]"]').val();
       
        $('input[name="impv_info2[pers_firstname_th]"]').val(pers_firstname);  
        $('input[name="impv_info2[pers_lastname_th]"]').val(pers_lastname);
        $('input[name="impv_info2[date_of_birth]"]').val(date_birth);		
        $('input[name="impv_info2[gender_code]"]').val(gender);

        $('input[name="impv_addr2[addr_home_no]"]').val(addr_home_no);  
        $('input[name="impv_addr2[addr_moo]"]').val(addr_moo);                                               
  
        $('input[name="impv_addr2[addr_province]"]').val(addr_province);		
        $('input[name="impv_addr2[addr_district]"]').val(addr_district);
        $('input[name="impv_addr2[addr_sub_district]"]').val(addr_sub_district);	
        $('input[name="impv_addr2[addr_lane]"]').val('');
        $('input[name="impv_addr2[addr_alley]"]').val('');
        $('input[name="impv_addr2[addr_road]"]').val('');  
    //     notice_excep_age(req_pers.age);
    //     getPersInfo(inputpid, bt_spid, setData, true); //Get Data
    // }
    //$(".elder_same_req").attr('disabled',true);
});



function bt_req_pid(){
// alert("ss");
var pid_id = $('#req_pid').val();
var reqId = pid_id.replaceAll("-","");
$('#diff_pid').val(reqId); 
showloadersc('warning','กรุณารอสักครู่ กำลังโหลดข้อมูล !');

$.ajax({  
                type: 'GET',
                crossDomain: true,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                // data: param_service,
                url: base_url+"/adaptenvir/getTokenID/",
                success: function(data_token) {
                    //console.log(data_token)                       
                  
                    $.ajax({
                      type: "POST",
                      url: base_url+"/adaptenvir/getDataPid/",
                      data: { req_pid : $('#req_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                      success: function(data){
                        //console.log(data)
                        if ($('#req_pid').val() == "_-____-_____-__-_" || $('#req_pid').val() == "") { 
                          closeloadswal();
                          toastr.error("โปรดตรวจสอบข้อมูลเลขบัตรประจำตัวประชาชนผู้สูงอายุ", "หน้าต่างแจ้งเตือน");   
                        
                        }else { 

                          if (!!data.firstName && !!data.lastName) {                               
                           
                            var varBD = data.dateOfBirth.toString();
                            // var res = varCard.split("");
                            var res1 = varBD.substring(0, 4);
                            var res2 = varBD.substring(4, 6);
                            var res3 = varBD.substring(6, 8);
                            //1960-08-07
                            var varBirthday = (res1-543)+'-'+res2+'-'+res3
                            var varBirthdayText = res1+'-'+res2+'-'+res3
                            //console.log('>>>>>>>>',varBirthday)
                            $.ajax({
                              type: "POST",
                              url: base_url+"/adaptenvir/getBirthday/",
                              data: {birthday : varBirthdayText,csrf_dop : csrf_hash},
                              success: function(data){

                                $('#req_date_of_birth_text').html(data); 
                                
                              },
                              dataType: "json",
                            });

                            $('#req_name').html(data.firstName+' '+data.lastName);                              
                            //$('#req_date_of_birth').html(data.dateOfBirth);
                            $('#req_gender_name').html(data.genderDesc);            
                            $('#pers_firstname_th').val(data.firstName);
                            $('#pers_lastname_th').val(data.lastName);
                            $('#gender_code').val(data.genderCode);
                           // $('#date_of_birth').val(data.dateOfBirth);     
                            $('#date_of_birth').val(varBirthday);    
                            $.ajax({
                              type: "POST",
                              url: base_url+"/adaptenvir/getAddress/",
                              // data: {req_pid : $('#req_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                              data: { req_pid : $('#req_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                              success: function(dataAdderss){
                                //console.log(dataAdderss)
                              var addressname = dataAdderss.houseNo +' หมู่ที่ '+dataAdderss.villageNo +' '+' ตำบล'+dataAdderss.subdistrictDesc +' '+' อำเภอ'+dataAdderss.districtDesc +' '+' จังหวัด'+dataAdderss.provinceDesc;
                                $('#req_reg_addr').html(addressname);
                                $('#req_reg_addr_id').val(addressname);                 
            
                              $('input[name="impv_addr[addr_moo]"]').val(dataAdderss.villageNo);
                              $('input[name="impv_addr[addr_home_no]"]').val(dataAdderss.houseNo);
                              $('input[name="impv_addr[addr_lane]"]').val(dataAdderss.roadDesc);
                              $('input[name="impv_addr[addr_alley]"]').val('');
                              $('input[name="impv_addr[addr_road]"]').val('');
           
                              var province = dataAdderss.provinceDesc.replace("จังหวัด","");
                              var amphur = dataAdderss.districtDesc.replace("อำเภอ","");
                              var tambol = dataAdderss.subdistrictDesc.replace("ตำบล","");
                              
                              $.ajax({
                                type: "POST",
                                url: base_url+"/adaptenvir/getarea/",
                                data: {province_name : province,amphur_name : amphur,tambol_name : tambol,csrf_dop : csrf_hash},
                                success: function(dataArea){
                                 // console.log('>>>>>>>>',dataArea)	
                                  closeloadswal();				
                                  $('input[name="impv_addr[addr_province]"]').val(dataArea.province_code);		
                                  $('input[name="impv_addr[addr_district]"]').val(dataArea.amphur_code);
                                  $('input[name="impv_addr[addr_sub_district]"]').val(dataArea.tambol_code);		
                                  
                                },
                                dataType: "json",
                              });
                              },
                              dataType: "json",
                            }); 
                          }
                          else{
                            closeloadswal();
                            toastr.error("ไม่พบข้อมูล", "หน้าต่างแจ้งเตือน");  
                                                       
                       
                          }
                                                          
                        
                        }  
                       
                      },
                      error: function(err) {
                        closeloadswal();
                        toastr.error("โปรดตรวจสอบข้อมูลเลขบัตรประจำตัวประชาชนผู้สูงอายุ", "หน้าต่างแจ้งเตือน");
                      
                      }
                    });
                  
                   
      
                    

                },
                error: function(err) {
                  console.log(err)
                  //var text = 'ไม่พบข้อมูล';
                  //token
                  toastr.error("ไม่พบข้อมูล", "หน้าต่างแจ้งเตือน");
                 
                }
});

} 


function bt_elder_pid(){

showloadersc('warning','กรุณารอสักครู่ กำลังโหลดข้อมูล !');
var pid_id = $('#elder_pid').val();
var reqId = pid_id.replaceAll("-","");
$('#pid_id').val(reqId); 

$.ajax({  
                type: 'GET',
                crossDomain: true,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                // data: param_service,
                url: base_url+"/adaptenvir/getTokenID/",
                success: function(data_token) {
                    //console.log(data_token)                       
                  
                    $.ajax({
                      type: "POST",
                      url: base_url+"/adaptenvir/getDataPid/",
                      data: { req_pid : $('#elder_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                      success: function(data){
                        //console.log(data)
                        if ($('#elder_pid').val() == "_-____-_____-__-_" || $('#elder_pid').val() == "") { 
                          closeloadswal();
                          toastr.error("โปรดตรวจสอบข้อมูลเลขบัตรประจำตัวประชาชนผู้สูงอายุ", "หน้าต่างแจ้งเตือน");   
                        
                        }else { 

                          if (!!data.firstName && !!data.lastName) {                               
                            var varBD = data.dateOfBirth.toString();
                            // var res = varCard.split("");
                            var res1 = varBD.substring(0, 4);
                            var res2 = varBD.substring(4, 6);
                            var res3 = varBD.substring(6, 8);
                            //1960-08-07
                            var varBirthday = (res1-543)+'-'+res2+'-'+res3
                            var varBirthdayText = res1+'-'+res2+'-'+res3
                            //console.log('>>>>>>>>',varBirthday)
                            $.ajax({
                              type: "POST",
                              url: base_url+"/adaptenvir/getBirthday/",
                              data: {birthday : varBirthdayText,csrf_dop : csrf_hash},
                              success: function(data){

                                $('#date_of_birth_sufferer').html(data); 
                                
                              },
                              dataType: "json",
                            });

                            $('#name_sufferer').html(data.firstName+' '+data.lastName);                              
                           // $('#date_of_birth_sufferer').html(data.dateOfBirth);
                            $('#gender_name_sufferer').html(data.genderDesc);            
                            $('input[name="impv_info2[pers_firstname_th]"]').val(data.firstName);
                            $('input[name="impv_info2[pers_lastname_th]"]').val(data.lastName);
                            $('input[name="impv_info2[gender_code]"]').val(data.genderCode);
                            $('input[name="impv_info2[date_of_birth]"]').val(varBirthday);      
                            $.ajax({
                              type: "POST",
                              url: base_url+"/adaptenvir/getAddress/",
                              // data: {req_pid : $('#req_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                              data: { req_pid : $('#elder_pid').val(),tokenId : data_token,csrf_dop : csrf_hash},
                              success: function(dataAdderss){
                                //console.log(dataAdderss)
                              var addressname = dataAdderss.houseNo +' หมู่ที่ '+dataAdderss.villageNo +' '+' ตำบล'+dataAdderss.subdistrictDesc +' '+' อำเภอ'+dataAdderss.districtDesc +' '+' จังหวัด'+dataAdderss.provinceDesc;
                                $('#reg_addr').html(addressname);         
                                $('input[name="impv_addr2[addr_moo]"]').val(dataAdderss.villageNo);
                                  // //$('#date_of_birth').val((bd1-543)+'-'+bd2+'-'+bd3);                      
                                  // $('#addrProvince').attr(data.addrProvince);
                                  // $('#addrAmphur').attr(data.addrAmphur);
                                  // $('#addrTambol').attr(data.addrTambol);
                                  $('input[name="impv_addr2[addr_home_no]"]').val(dataAdderss.houseNo);
                                 // $('input[name="impv_addr[addr_moo]"]').val(houseNo);
                                  $('input[name="impv_addr2[addr_lane]"]').val(dataAdderss.roadDesc);
                                  $('input[name="impv_addr2[addr_alley]"]').val('');
                                  $('input[name="impv_addr2[addr_road]"]').val('');
                                  // var province = dataAdderss.provinceDesc.replace("จังหวัด","");
                                  // var amphur = dataAdderss.districtDesc.replace("อำเภอ","");
                                  // var tambol = dataAdderss.subdistrictDesc.replace("ตำบล","");
                                  
                                  var province = dataAdderss.provinceDesc;
                                  var amphur = dataAdderss.districtDesc;
                                  var tambol = dataAdderss.subdistrictDesc;
                                  
                                  $.ajax({
                                    type: "POST",
                                    url: base_url+"/adaptenvir/getarea/",
                                    data: {province_name : province,amphur_name : amphur,tambol_name : tambol,csrf_dop : csrf_hash},
                                    success: function(dataArea){
                                     // console.log('>>>>>>>>',dataArea)	
                                     closeloadswal();				
                                      $('input[name="impv_addr2[addr_province]"]').val(dataArea.province_code);		
                                      $('input[name="impv_addr2[addr_district]"]').val(dataArea.amphur_code);
                                      $('input[name="impv_addr2[addr_sub_district]"]').val(dataArea.tambol_code);		
                                      
                                    },
                                    dataType: "json",
                                  });



                              },
                              dataType: "json",
                            }); 
                          }
                          else{
                            closeloadswal();
                            toastr.error("ไม่พบข้อมูล", "หน้าต่างแจ้งเตือน");  
                                                       
                       
                          }
                                                          
                        
                        }  
                       
                      },
                      error: function(err) {
                        closeloadswal();
                        toastr.error("โปรดตรวจสอบข้อมูลเลขบัตรประจำตัวประชาชนผู้สูงอายุ", "หน้าต่างแจ้งเตือน");
                      
                      }
                    });
                  
                   
      
                    

                },
                error: function(err) {
                  // console.log(err)
                  closeloadswal();
                  //var text = 'ไม่พบข้อมูล';
                  //token
                  toastr.error("ไม่พบข้อมูล", "หน้าต่างแจ้งเตือน");
                 
                }
});

} 
</script>

<script src="https://center.dop.go.th/assets/js/loading_popup.js"></script>
